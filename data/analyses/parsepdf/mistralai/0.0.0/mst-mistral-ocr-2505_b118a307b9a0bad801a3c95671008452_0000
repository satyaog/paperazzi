{
  "pages": [
    {
      "markdown": "# Optimising Electric Vehicle Charging Station Placement using Advanced Discrete Choice Models \n\nSteven Lamontagne ${ }^{1}$, Margarida Carvalho ${ }^{1}$, Emma Frejinger ${ }^{1}$, Bernard Gendron ${ }^{1}$, Miguel F. Anjos ${ }^{2}$, and Ribal Atallah ${ }^{3}$<br>${ }^{1}$ CIRRELT and Département d'informatique et de recherche opérationnelle, Université de Montréal<br>${ }^{2}$ School of Mathematics, University of Edinburgh<br>${ }^{3}$ Institut de Recherche d'Hydro-Québec\n\nMay 26, 2023\n\n## 1 Introduction\n\nIn order to meet $\\mathrm{CO}_{2}$ emissions goals, major changes at the global level are necessary. This includes the transportation sector, which in 2019 was responsible for $27 \\%$ of global $\\mathrm{CO}_{2}$ emissions (International Energy Agency 2021) and $30 \\%$ of emissions in Canada (Environment and Climate Change Canada 2021). One initiative that has been proposed to reduce these emissions is the adoption of electric vehicles (EVs), rather than internal combustion engine vehicles (ICEVs). Depending on the electricity generation mix, this may be effective in reducing emissions (Axsen et al. 2015a, Woo et al. 2017).\n\nDue to the limits of the internal battery, EVs require more frequent refuelling than CVs. While early adopters of EVs may have access to home charging (Bailey et al. 2015), this can be supplemented with public charging infrastructure to increase accessibility. The availability of the latter has been found to increase EV adoption (e.g. Coffman et al. 2017). However, this scenario has been noted to suffer from a \"chicken-and-egg\" dilemma (Anjos et al. 2020), where users require charging infrastructure in order to purchase an EV, while businesses and infrastructure operators have little incentive to install charging stations when there are few users. To this end, governmental organisations can alleviate this problem by investing in public charging infrastructure, thus allowing users to recharge EVs and encourage EV adoption.\n\nThe problem we examine is that of the decision makers responsible for public charging infrastructure, and the optimal placement of that infrastructure within a city. They have a"
    },
    {
      "markdown": "set of candidate locations for charging stations, and must decide which charging stations to open as well as how many charging outlets to place at each open station. These decisions take place over a long-term planning horizon, and investment in each period is limited by a budget. The decision makers take into account the users who are purchasing a vehicle in each period. Depending on the placement of charging infrastructure, these users may purchase an EV. We assume that the users anticipate the need to recharge an EV, and will only purchase one if they have access to charging infrastructure (either public or at home). Additionally, we assume that more convenient charging (e.g. by a charging station being closer to home, or having more charging outlets) increases the probability that a user will purchase an EV. The goal of the decision makers is to plan the placement of charging infrastructure so that it maximises EV adoption.\n\nThe existing literature for this problem is quite narrow, and has limitations that we address in this work. In the intercity context, the optimisation model of Zhang et al. (2017) accounts for EV adoption growth depending on the coverage of paths, but their method is not applicable to the intracity case. To the best of our knowledge, in the intracity context, only Anjos et al. (2020) formulate an optimisation model for locating charging stations accounting for EV adoption growth based on the location of charging stations. There, the total number of EVs increases according to a piecewise-linear growth function, which accounts for natural growth. This growth function is applied indiscriminately to all locations. Additionally, the fraction of users who have access to home charging is assumed to be constant across locations in the network. In reality, the EV growth rate varies by location (Association des Véhicules Électrique du Québec 2021), and access to home charging depends on the type of residences (Nicholas et al. 2019).\n\nThis work presents modelling, algorithmic, and computational contributions. For the modelling side, we consider user classes, allowing for parameter values to be considered more specifically for groups of users rather than the entire population. Additionally, within each user class, the optimisation model supports the use of advanced discrete choice models. Acknowledging the uncertainty associated with demand distribution, these models assign a probability distribution over available alternatives. This allows to model heterogeneous user preferences and complex substitution patterns. The combination of the user classes and the ability to use advanced discrete choice models results in a highly flexible model, which the decision makers can design to suit their specific problem and available data sources. The user behaviour is incorporated in the decision-maker's problem as in Pacheco Paneque et al. (2021), leading to a bilevel program. While the bilevel optimisation model presented here can only solve small instances, the maximum covering reformulation allows for instances to be solved significantly faster. To the best of our knowledge, such a reformulation has not been presented in the context of the simulationbased approach of Pacheco Paneque et al. (2021). We note that this reformulation is effective for our optimisation model, but is also applicable to more general, uncapacitated bilevel models using the same framework. On the algorithmic side, we propose"
    },
    {
      "markdown": "three heuristics to solve the optimisation models. First, a rolling horizon method, which was also used in Anjos et al. (2020). Second, a greedy method (Church and ReVelle 1974), and third, a GRASP method (Resende 1998). We extend the latter two to a multi-period setting with sizing decisions. On the computational side, we present extensive experimental comparisons examining: the capabilities of our optimisation model versus the model presented in Anjos et al. (2020), the bilevel formulation versus maximum covering formulation, and the heuristic methods. Where possible, parameter values and user class characteristics are based on real data.\n\nWe structure the remainder of the paper as follows: Section 2 reviews the relevant literature for the problem. Section 3 describes the framework of the problem, as well as briefly presenting the bilevel model and its single-level reformulation. Section 4 gives the maximum covering reformulation for the bilevel model. Section 5 discusses various heuristic methods for solving large instance sizes of practical interest. Section 6 provides computational results.\n\n# 2 Literature Review \n\nWe review three topics of research that relate closely to our work. First, EV charging station location models, which determines the optimal location for charging stations. Second, vehicle acquisition, more specifically relating to EVs, which discusses factors that affect whether users purchase EVs. Third, Maximum Capture Problem with Random Utilities (MCPRU), which examines the optimal placement of facilities in a competitive environment.\n\nOn the topic of EV charging station location models, the model proposed by Anjos et al. (2020), which we refer to as the Growth Function (GF) model, is the closest to our work. Whereas most charging station location models are examined with the objective to maximise profits or minimise costs, the GF model is designed solely to encourage electric vehicle adoption. Its use of a combination of node-based and path-based approaches allows for the inclusion of a general highway charging station network while allowing for increased precision within the city. EV adoption and charging stations are linked via capacity constraints, with users willing to recharge at any charging station within a fixed distance of their home.\n\nThere is an existing literature for EV charging station placement (an excellent review is presented in Kadri et al. 2020), however two notable differences separate it from our work. First, in all cases, the users under consideration are those who already own EVs, and are deciding on a charging station to recharge. Second, the objective of the decision maker are different, such as profit maximisation (Luo et al. 2015), maximising the EV flow that can travel each path given a limited EV range (Lim and Kuby 2010), minimising the users' costs for recharging the EV and travel time (González et al. 2022), or maximising the EV charging demand that can be covered (Frade et al. 2011). We provide a summary"
    },
    {
      "markdown": "of the key characteristics of related works in Table 1.\nUnlike our work, EV recharging demand at each station or along each path is generally taken to be deterministic. However, in Luo et al. (2015) and Cui et al. (2019) the demand for each station is estimated using the analytic choice probabilities from a nested logit model. The demand model they use considers station characteristics such as the distance to the EV owner and the proximity of the charging station to amenities (such as restaurants and shopping centres). In Kadri et al. (2020), the evolution each year of the demand for each path is modelled with a discrete scenario tree. In the tree, the demand for the current year is assumed to be known, as are the transition probabilities for each of the possible states in each subsequent year. This allows for the estimation of the expected demand of each path considering all subsequent years.\n\nThe inclusion of capacity constraints in EV charging station location models is not consistent. Several models (including our work, as well as others in Table 1) do not consider capacity. For those that do include capacity constraints, the modelling assumptions differ. In Frade et al. (2011) and Zhang et al. (2017), the demand that may be satisfied by each charging station is limited by the number of outlets installed at that location. In Luo et al. (2015), the decision maker must ensure that charging stations meet minimum quality of service requirements, including waiting time and service coverage. In Cui et al. (2019), the decision maker must ensure that the amount of electricity supplied at each charging station is sufficient for the expected amount of demand. In González et al. (2022), the number of recharging sessions that will be required at each station is estimated, and used as a bound for the capacity of the station.\n\nThe vehicle acquisition problem examines the attributes that increase the likelihood of purchasing EVs, and are useful for determining exogenous attributes for the demand model and defining user classes. Importantly, the availability of electric vehicle charging stations increases the likelihood of users purchasing an EV; This availability (also referred to as 'fuel availability'), was a significant factor in the decision to purchase an EV in most articles examining the subject (Achtnicht et al. 2012, Javid and Nejat 2017, Hackbarth and Madlener 2013, Ziegler 2012, Rezvani et al. 2015, Coffman et al. 2017). This finding is not unanimous, however, as Bailey et al. (2015) propose that a predisposition to EVs makes the users more likely to notice existing charging infrastructure, not the converse. The conclusions of Bailey et al. (2015) are also present in Axsen et al. (2015b), an article based on the same dataset and project. Several studies focus on assessing preferences in regard to various types of attributes (Hidrue et al. 2011, Achtnicht et al. 2012, Ziegler 2012, Hackbarth and Madlener 2013, Axsen et al. 2015b, Bailey et al. 2015, Javid and Nejat 2017). For reviews of EV acquisition models, we refer to Rezvani et al. (2015), Javid and Nejat (2017), and Coffman et al. (2017).\n\nIn this work, we formulate the problem as a MCPRU, generally attributed to Benati (1999) and Benati and Hansen (2002). In the MCPRU, a company is looking to place facilities in an environment where competitors have existing facilities. A Random Utility"
    },
    {
      "markdown": "|  | Objective | Model <br> Type | Demand | Time <br> Periods | Capacity | Intracity <br> or <br> Intercity |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n| Lim and Kuby (2010) | Maximise flow <br> refueled | FRLM | D | Single | No | Inter |\n| Frade et al. (2011) | Maximise <br> coverage of EV <br> charging demand | Maximum <br> Covering | D | Single | Yes | Intra |\n| Shukla et al. (2011) | Maximise flow <br> intercepted | FILM | D | Single | No | Intra |\n| Capar et al. (2013) | Maximise flow <br> refueled | FRLM | D | Single | No | Inter |\n| Luo et al. (2015) | Maximise profit <br> of decision maker | MINLP | S | Multi | Yes | Intra |\n| Zhang et al. (2017) | Maximise flow <br> refueled | FRLM | D | Multi | Yes | Inter |\n| Cui et al. (2019) | Minimise cost of <br> decision maker | MINLP | S | Multi | Yes | Intra |\n| Badri-Koohi et al. (2019) | ```Minimise costs, p-median, flow interception (weighted sum)``` | MILP | D | Single | No | Intra |\n| Kadri et al. (2020) | Maximise flow <br> refueled | FRLM | S | Multi | No | Inter |\n| González et al. (2022) | ```Minimise users' travel cost``` | Bilevel | D | Single | Yes | Intra |\n\nLegend: FRLM = Flow Refueling Location Model, FILM = Flow Interception Location Model, MINLP $=$ Mixed Integer Non-Linear Problem, MILP $=$ Mixed Integer Linear Problem, $\\mathrm{D}=$ Deterministic, $\\mathrm{S}=$ Stochastic.\n\nTable 1: Summary of key characteristics of EV charging station location models."
    },
    {
      "markdown": "Maximisation (RUM) discrete choice model is used to assign choice probabilities of users, based on the set of facilities available to them. The company aims to place the new facilities to maximise the market share that the new facilities capture. In general, the MCPRU focuses on two key attributes of facilities in order to determine which one users choose to patronise: distance to the users, and facility attractiveness (Berman et al. 2014). It is possible to consider market expansion in the MCPRU, where the placement of facilities attracts customers that were not originally in the market (see, e.g., Aboolian et al. 2007). Since a vehicle (EV or otherwise) is an expensive purchase, it is assumed that the additions to the charging infrastructure are not sufficient to attract users who were not planning on purchasing a vehicle at all in the given period. We thus do not include market expansion in our optimisation model.\n\nAlmost all work on the MCPRU has been done in the context of using the multinomial logit (MNL) model for characterising user behaviours, due to the existence of an analytic formula for calculating choice probabilities. For recent examples, the linear formulation in Freire et al. (2016) (which improves on the linear formulation in Haase 2009) and the outer approximation and submodular cut methods in Ljubić and Moreno (2018) both rely on the logit choice probabilities. Exceptions to the use of MNL model include the work of Mai and Lodi (2020), who express a mixed logit choice probability as a sum of probabilities of MNL models (though they do not conduct any computational experiments using this method), and the work of Dam et al. (2022), who use a method that makes use of the submodularity of the objective function for all discrete choice models in the Generalised Extreme Value (GEV) family (of which MNL and mixed logit are included). Since we do not assume the use of MNL or the GEV family (in addition to the added complexity of multi-period and sizing considerations), the methods proposed in these works cannot be applied directly to our model.\n\nWhile it can be used more generally, the simulation-based approach in Pacheco Paneque et al. (2021) can be applied to the MCPRU. Rather than embedding an analytic probability that users will select an alternative into the objective function, this approach instead generates error terms for each alternative for a given number of scenarios. These error terms, pre-computed and given to the optimisation model as an input, allow for the utility to be calculated for each alternative and each scenario. Using the RUM principle, users then select, in each scenario, the alternative which has the highest utility. Alternatives which are not available to users (such as, in the case of the MCPRU, facilities which are closed) are set to a lower bound, ensuring they are not selected. This approach supports the use of any discrete choice model rather than being limited to the MNL model (or even the GEV family). However, it is computationally difficult to solve in larger instances.\n\nWe emphasise that the simulation-based approach of Pacheco Paneque et al. (2021) differs from the linearisation typically presented for the MCPRU (e.g. Benati and Hansen 2002, Haase 2009, Haase and Müller 2014, Freire et al. 2016). In the latter case, the"
    },
    {
      "markdown": "analytic choice probabilities for each alternative are linearised by setting the variable coefficients appropriately. However, this linearisation can only be done when analytic choice probabilities are known for the discrete choice model (e.g. MNL). On the contrary, the simulation-based approach assumes that the utility functions are linear in the decision variables and works directly in the space of utilities. Under the RUM principle, this allows for linearisation of the sample average approximation of the choice probabilities (which can be derived for any discrete choice model for which error terms can be drawn). As a consequence, the choice probabilities are approximations of their exact form, but also renders the approach suitable for any discrete choice model. This includes, notably, discrete choice models for which the choice probabilities are typically estimated via sample average approximation (e.g. mixed logit Train 2002).\n\nOur work aims to bridge the gap between the EV charging station placement models, EV acquisition models, and the MCPRU. Most EV charging station placement models are designed to benefit existing EV owners, instead of maximising EV adoption. The existing works which include EV growth based on the placement of EV charging stations, namely the models of Zhang et al. (2017) and Anjos et al. (2020), use an aggregate approach for EV growth. However, the literature on EV acquisition shows that significant factors for determining EV acquisition are individual characteristics of the users (e.g. income, education level, access to home charging). This highlights the benefit of user classes in our optimisation model, as they allow for these individual characteristics to be considered. Moreover, we note the heterogeneity within each preference class (which function equivalently as a user class in our work) in the latent class models of Hidrue et al. (2011) and Axsen et al. (2015b). This suggests the use of a discrete choice model for demand modelling, and naturally leads to a MCPRU formulation for the optimisation model. As is the case for the MCPRU, in addition to user characteristics, characteristics from the charging station also impact the choice of users. While the specification of the discrete choice model for the users is outside the scope of this work, we note in Appendix A characteristics of the demand modelling which makes the MNL model less suitable. Because of this, we use the simulation-based approach of Pacheco Paneque et al. (2021).\n\n# 3 Problem Formulation and Modelling \n\nIn our problem, we consider the placement of charging infrastructure in a city, wherein there are two parties with different motives: a decision maker placing the infrastructure, and the users choosing whether to purchase an EV (depending on the charging infrastructure). An illustration of this process is given in Figure 1."
    },
    {
      "markdown": "# 3.1 Decision Maker \n\nThe decision maker is planning charging infrastructure over a planning horizon with $T$ periods (e.g., seasons or years) indexed by $1 \\leq t \\leq T$.\n\nThe decision maker has a candidate set of locations $M$ where charging stations $j \\in M$ may be installed or expanded with additional outlets to a maximum number $m_{j}$. In each period $t$, there is a budget $B^{t}$, which limits the total investment (both opening stations and installing outlets). Let $c_{j k}^{t}$ denote the cost to go from $k-1$ to $k$ outlets at charging station $j \\in M$ in period $t$. Note that this cost concept is flexible, and accounts for additional costs to be incorporated at certain thresholds if significant infrastructure upgrades are required. Notably, this includes initial infrastructure installation for $k=1$ but can also include, e.g., increasing electric power capacity at the station.\n\nLet $x_{j k}^{t}$ be a binary variable indicating if station $j \\in M$ has at least $k$ outlets in period $t$ (with $\\left.1 \\leq k \\leq m_{j}\\right)$. We denote $\\mathbf{x}=\\left\\{x_{j k}^{t}\\right\\}, j \\in M, 1 \\leq k \\leq m_{j}, 1 \\leq t \\leq T$. Let $x_{j k}^{0}$ denote the initial state of each charging station $j$.\n\n### 3.2 Users\n\nWe consider users who are are planning on purchasing a vehicle and, depending on public charging infrastructure, may choose to purchase an EV. These users are composed of a set of user classes $N$. The population size for each user class is given by $N_{i}^{t}, i \\in N, 1 \\leq t \\leq T$. These parameters provide a flexible modelling. For instance, they can correspond to the number of potential new EVs in a class or be configured to prioritise early adopters by decreasing the population size in later time periods. This would have an effect similar to the classical approach of discounting future time periods.\n\nEach user considers whether they have a primary option for recharging an EV. If such an option is available and sufficient for their needs, they decide to purchase an EV. This decision is modelled via a discrete choice model, with users in user class $i \\in N$ selecting an alternative $j$ in choice set $\\mathcal{C}_{i}^{t}(\\mathbf{x})$. The inclusion of $\\mathbf{x}$ in the notation for the choice set emphasises the dependence on the set of open stations, since stations without at least one outlet cannot be used to recharge an EV. The choice set $\\mathcal{C}_{i}^{t}(\\mathbf{x})$ contains a subset of the public charging infrastructure, home charging (if available to user class $i$ ), and an opt-out. The latter corresponds to the alternative to not purchase an EV, while all other alternatives indicate the user purchases one. In what follows, we denote the opt-out alternative as $j=0$. We note that the use of the index $j$ for both alternatives and stations is deliberate because, as we discuss in Section 3.3, the charging stations are the alternatives for the most part.\n\nAt the strategic-level planning, we assume that each charging station $j \\in M$ that is opened is uncapacitated, in the sense that there is no limit to the number of users that may select it. However, we assume that the likelihood of users selecting a given station increases with the number of outlets. The rationale being that the higher the number of"
    },
    {
      "markdown": "![img-0.jpeg](img-0.jpeg)\n\nFigure 1: The decision maker decides where to place charging infrastructure (stations and number of outlets) on the simple example network. In response, a subset of users decide to purchase EVs.\noutlets, the more likely one may be available when required. This allows us to implicitly take into account that users perceive the capacity as finite.\n\n# 3.3 Simulation-based Model \n\nWe adopt the simulation-based method of Pacheco Paneque et al. (2021) to the users' decision to purchase an EV. More specifically, for each user class $i \\in N$, let $R_{i}$ be the number of scenarios used to approximate the choice probabilities. We assume that the decision to purchase an EV is separable for each user class, each period, and each scenario, meaning that there is no interaction among them. Therefore, in what follows, we concentrate on detailing a given triplet $(t, i, r) \\in P=\\left\\{\\left(t^{\\prime}, i^{\\prime}, r^{\\prime}\\right): 1 \\leq t^{\\prime} \\leq T, i^{\\prime} \\in\\right.$ $\\left.N, 1 \\leq r^{\\prime} \\leq R_{i^{\\prime}}\\right\\}$. For each alternative $j \\in \\mathcal{C}_{i}^{t}(x)$, let $u_{j i}^{r t}$ be the simulated utility.\n\nWe previously remarked that the choice set $\\mathcal{C}_{i}^{t}(\\mathbf{x})$ depends on which stations are open. For notational simplicity, we define the two choice sets: $C_{i}^{0 t}$ and $C_{i}^{1 t}$. The set $C_{i}^{0 t}$ includes all alternatives exogenous to the optimisation model (i.e. unaffected by decision variables), for which the availability is not under the control of the decision maker. This always includes the opt-out alternative, but may also, for example, include the alternative for home charging. The simulated utility $u_{j i}^{r t}$, for $j \\in C_{i}^{0 t}$, is thus given by\n\n$$\nu_{j i}^{r t}=\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}\n$$\n\nwhere the parameter $\\kappa_{j i}^{t}$ is the alternative-specific constant. In general, the alternativespecific constants can be any function which does not depend on the decision variables. Note that we assume only one opt-out alternative as multiple options can be replaced by a single alternative given by the maximum utility across all opt-out alternatives."
    },
    {
      "markdown": "The set $C_{i}^{1 t}$ includes the alternatives for charging stations which have a non-zero probability of being chosen (e.g. sufficiently close to be considered). If station $j \\in C_{i}^{1 t}$ is open, we consider the utility $u_{j i}^{r t}$ to be a function of the number of charging outlets available at that station as well as the alternative-specific constant. This leads to the formulation: $u_{j i}^{r t}=\\sum_{k=1}^{m_{j}} \\beta_{j i k}^{t} x_{j k}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}$. We recall that $m_{j}$ is the maximum number of outlets at station $j$. The parameter $\\beta_{j i k}^{t}$ is the incremental benefit of going from $k-1$ to $k$ outlets. The model does not impose any restrictions on the form of the utility coefficients, however, we assume that the coefficients are non-negative. As before, the alternative-specific constant can be any function which does not depend on the decision variables. If the station is closed, the utility is set to a lower bound $\\underline{a}_{i}^{t}$ to ensure that it will not be selected.\n\n# 3.4 Single-Level Model \n\nGiven $\\mathbf{x}$ and a triplet $(t, i, r)$, a user selects the alternative maximising the simulated utility, i.e., $k \\in \\arg \\max _{j \\in \\mathcal{C}_{i}^{t}(\\mathbf{x})} u_{j i}^{r t}$. If we now integrate the goal of the decision maker, which is to maximise the purchase of EVs, we naturally obtain a bilevel formulation. Following the simulation-based method of Pacheco Paneque et al. (2021), we can reduce the bilevel formulation to a single-level form. Indeed, the Single-Level (SL) model of the"
    },
    {
      "markdown": "problem is given by\n\n$$\n\\begin{aligned}\n& \\text { Minimise } \\sum_{(t, i, r) \\in P} \\frac{N_{i}^{t}}{R_{i}} w_{0 i}^{r t} \\\\\n& \\text { subject to } \\sum_{j \\in M} \\sum_{k=1}^{m_{j}} c_{j k}^{t}\\left(x_{j k}^{t}-x_{j k}^{t-1}\\right) \\leq B^{t}, \\quad & 1 \\leq t \\leq T \\\\\n& x_{j k}^{t} \\leq x_{j k-1}^{t}, & 1 \\leq t \\leq T, j \\in M, 1 \\leq k \\leq m_{j} \\\\\n& x_{j k}^{t} \\geq x_{j k}^{t-1}, & 1 \\leq t \\leq T, j \\in M, 1 \\leq k \\leq m_{j}\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\n& u_{j i}^{r t}=\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}, \\quad(t, i, r) \\in P, j \\in C_{i}^{0 t} \\\\\n& u_{j i}^{r t} \\geq \\underline{a}_{i}^{t}, \\quad(t, i, r) \\in P, j \\in C_{i}^{1 t} \\\\\n& u_{j i}^{r t} \\leq \\underline{a}_{i}^{t}+\\nu_{j i}^{r t} x_{j 1}^{t}, \\quad(t, i, r) \\in P, j \\in C_{i}^{1 t}\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\n& u_{j i}^{r t} \\geq \\sum_{k=1}^{m_{j}} \\beta_{j i k}^{t} x_{j k}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}-\\nu_{j i}^{r t}\\left(1-x_{j 1}^{t}\\right),(t, i, r) \\in P, j \\in C_{i}^{1 t} \\\\\n& u_{j i}^{r t} \\leq \\sum_{k=1}^{m_{j}} \\beta_{j i k}^{t} x_{j k}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}, \\quad(t, i, r) \\in P, j \\in C_{i}^{1 t} \\\\\n& u_{j i}^{r t}-\\alpha_{i}^{r t}+\\left(1-w_{j i}^{r t}\\right) \\mu_{j i}^{r t} \\geq 0, \\quad(t, i, r) \\in P, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t} \\\\\n& \\sum_{j \\in C_{i}^{0 t}} w_{j i}^{r t}+\\sum_{j \\in C_{i}^{1 t}} w_{j i}^{r t}=1, \\quad(t, i, r) \\in P \\\\\n& \\alpha_{i}^{r t} \\geq u_{j i}^{r t}, \\quad(t, i, r) \\in P, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t} \\\\\n& w_{j i}^{r t} \\in\\{0,1\\}, \\quad(t, i, r) \\in P, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t} \\\\\n& \\alpha_{i}^{r t} \\in \\mathbb{R}, \\quad(t, i, r) \\in P \\\\\n& u_{j i}^{r t} \\in \\mathbb{R}, \\quad(t, i, r) \\in P, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t}\n\\end{aligned}\n$$\n\nThe objective function (2a) minimises the number of users who do not purchase an EV (or, equivalently, maximises those who do) with the auxiliary variables $w_{j i}^{r t}$ representing the selection of alternative $j$ by the triplet $(t, i, r)$. Recall that $w_{0 i}^{r t}$ corresponds to the opt-out alternative, and indicates that the triplet $(t, i, r)$ does not purchase an EV. Budget constraints (2b) are given for each time period $t$. It would be possible to supplement the per-period budget with an overall budget, as was done in Anjos et al. (2020). Constraints (2c) impose that to have at least $k$ outlets, we must have at least $k-1$ outlets. Constraints (2d) forbid us from removing outlets once installed. Constraints (2e) set the utility for exogenous alternatives (opt-out, home charging, etc.). Constraints (2f)-(2i) set"
    },
    {
      "markdown": "the utility for endogenous alternatives (charging stations). Constraints (2j)-(21) ensure that the alternative with the highest utility is selected for each triplet $(t, i, r)$. We present the details around the model in Appendix A.\n\nWe note that Constraints (2e) set the utility for all exogenous alternatives in $C_{i}^{0 t}$, which includes opt-out and may include home charging. However, in practice, it is better to preprocess any triplets which have access to home charging: if the utility associated with home charging is lower than that of the opt-out, then home charging can be ignored (as it will never be selected). If it is higher than for the opt-out, then the associated opt-out choice variable $w_{0 i}^{c t}$ can be fixed to 0 , as we can guarantee that it will not be selected. As such, the set $C_{i}^{0 t}$ can be reduced to only contain the opt-out alternative.\n\n# 4 Maximum Covering Model \n\nWhile the SL model (2) is a Mixed-Integer Linear Programming (MILP) optimisation problem that can be given directly to a general purpose solver, large-scale instances can be hard to solve. This is due to the Big-M constraints for the utility (2f)-(2i) and the linearised lower-level problem (2j)-(21), as well as both sets of binary variables $\\mathbf{x}$ and w. While the Big-M values are tight given the bounds, as we will see in Section 6, the model is intractable for all but the simplest of instances. For this reason, we propose to reformulate the problem into a maximum covering problem using the pre-computed error terms $\\varepsilon_{j i}^{r t}$.\n\nFor $j \\in C_{i}^{1 t}$, define $u_{j i k}^{r t}=\\sum_{k^{\\prime}=1}^{k} \\beta_{j i k^{\\prime}}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{t}$. In other words, $u_{j i k}^{r t}$ is the utility for the triplet $(t, i, r)$ for charging station $j$ having $k$ outlets in period $t$. This is equivalent to the utility $u_{j i}^{r t}$ with $x_{j k^{\\prime}}^{t}=1$ if $k^{\\prime} \\leq k$ and $x_{j k^{\\prime}}^{t}=0$ if $k^{\\prime}>k$.\nDefinition 4.1. A charging station $j$ with $k$ charging outlets covers the triplet $(t, i, r)$ if the following conditions hold: (i) $k \\geq 1$, (ii) $j \\in C_{i}^{1 t}$, and (iii) $u_{j i k}^{r t} \\geq u_{0 i}^{r t}$, where $u_{0 i}^{r t}$ represents the opt-out utility for triplet $(t, i, r)$. We say that $(t, i, r)$ is covered by $\\mathbf{x}$ if $\\exists j \\in M, \\exists k \\in\\left\\{1, \\ldots, m_{j}\\right\\}$ such that $x_{j k}^{t}=1$ and charging station $j$ with $k$ charging outlets covers $(t, i, r)$.\n\nIntuitively, a charging station covers a triplet if the station has at least one outlet (and is thus open), it is available to and considered by the user class in question, and the charging station is a better option than the opt-out for that triplet.\nExample 4.2. We consider a given scenario $r$, user class $i$, and period $t$. In Figure 2, we see the utilities $u_{j i}^{r t}$ for each option $j \\in C_{i}^{0 t} \\cup C_{i}^{1 t}$. For each option, the error terms and alternative-specific constants are all pre-computed, which defines the values for utility with no charging outlets. The opt-out utility does not depend on the number of outlets, and so it is constant. Stations 1 and 3 only cover the triplet $(t, i, r)$ if they have at least one and four outlets, respectively. Station 2 is not able to cover $(t, i, r)$ even with six outlets."
    },
    {
      "markdown": "![img-1.jpeg](img-1.jpeg)\n\nFigure 2: Utilities for user class $i$, under scenario $r$, at period $t$.\n\nNext, we define $a_{j i k}^{r t}=1$ if station $j$ with $k$ outlets covers $(t, i, r)$, and 0 otherwise. This vector $a$ of parameters can be pre-computed after the error terms have been calculated. In the maximum covering formulation, we keep the variables $\\mathbf{x}$. We then define the covering decision variables $w_{i}^{r t}=1$ if $(t, i, r)$ is covered by $\\mathbf{x}$, and 0 otherwise.\n\nThe Maximum Covering (MC) model is then\n\n$$\n\\begin{aligned}\n& \\text { Maximise } \\sum_{(t, i, r) \\in P} \\frac{N_{i}^{t}}{R_{i}} w_{i}^{r t} \\\\\n& \\text { subject to }(2 \\mathrm{~b})-(2 \\mathrm{~d}) \\\\\n& \\sum_{j \\in M} \\sum_{k=1}^{m_{j}} a_{j i k}^{r t} x_{j k}^{t} \\geq w_{i}^{r t},(t, i, r) \\in P \\\\\n& x_{j k}^{t} \\in\\{0,1\\}, \\quad 1 \\leq t \\leq T, j \\in M, 1 \\leq k \\leq m_{j} \\\\\n& w_{i}^{r t} \\in[0,1], \\quad(t, i, r) \\in P\n\\end{aligned}\n$$\n\nThe objective function (3a) is the maximisation equivalent to the objective in the SL model (2a). Constraints (3b) model whether the triplet $(t, i, r)$ is covered by a given $\\mathbf{x}$. We note that due to the direction of the optimisation, these inequalities are satisfied with equality at an optimum. Since these constraints are the only ones on the variables $w_{i}^{r t}$, it is well-known that their integrality can be relaxed (Murray 2016). These constraints replace the utility constraints for choice set $C_{i}^{0 t}(2 \\mathrm{e})$, the utility constraints for choice set $C_{i}^{1 t}(2 \\mathrm{f})-(2 \\mathrm{i})$ and the maximisation of the users' utilities given by (lower-level problem) constraints (2j)-(21). They thus eliminate all Big-M constraints from the model. It is important to note that the maximum covering reformulation is possible because we consider the case where stations are uncapacitated. However, if we wished to include"
    },
    {
      "markdown": "capacity constraints, this would be straightforward for the SL model (2) (as was done in Pacheco Paneque et al. 2021).\n\n# 5 Heuristic Methods \n\nWhile the reformulation from the SL model (2) to the MC model (3) significantly improves tractability, the latter is still unable to solve larger instances, as shown in Section 6. We propose three heuristic methods for solving the MC model (3), including rolling horizon, greedy, and Greedy Randomised Adaptive Search Procedure (GRASP).\n\nWe note that, for the greedy and GRASP methods, it is required to calculate the quality of a candidate solution $\\mathbf{x}$. We denote it by\n\n$$\nf(\\mathbf{x})=\\sum_{(t, i, r) \\in P} \\frac{N_{i}^{t}}{R_{i}} \\min \\left(1, \\sum_{j \\in M} \\sum_{k=1}^{m_{j}} a_{j i k}^{r t} x_{j k}^{t}\\right)\n$$\n\n### 5.1 Rolling Horizon Heuristic\n\nSeveral variants of the rolling horizon heuristic exist, which form a standard approach in a multi-period setting. The basic version treats each period independently. We use this approach as a baseline. More precisely, we solve the MC model (3) for one period at a time, $1 \\leq t \\leq T$. Given the potential difficulty of solving the MC model (3) even when restricted to one period, a time limit is added. The best incumbent solution found within this time limit is returned by the heuristic.\n\nAn alternate version of the rolling horizon heuristic was tested, where for each time period $1 \\leq t \\leq T$ the variables $x_{j k}^{t}$ are discrete, but taken as continuous for $x_{i k}^{t^{\\prime}}, t^{\\prime}>t$. The variables $x_{j k}^{t}$ are then fixed, and we repeat the procedure for $t=t+1$. However, this method did not perform well in our application, due to the increased time required to solve each time period. Thus, we do not discuss this heuristic further in the rest of the paper.\n\n### 5.2 Greedy Heuristics\n\nThe maximum covering problem is generally attributed to Church and ReVelle (1974), where they also present a simple greedy heuristic. The algorithm presented here is a natural extension, where we iteratively place outlets one at a time, selecting the one which increases the number of new EVs the most.\n\nMore specifically, when considering the number of new EVs covered by a new outlet, there are two possible search modes. In the myopic search mode, only new EVs from the current period are counted. In the hyperoptic search mode, since any outlets placed in the current time period cannot be removed, the EVs in future time periods that result"
    },
    {
      "markdown": "from these outlets are also counted. Namely, we consider the following score functions when examining a candidate solution $\\tilde{x}$ in time period $t^{\\prime}$ :\n\n$$\n\\begin{aligned}\nf_{m}\\left(\\tilde{\\mathbf{x}}, t^{\\prime}\\right) & =\\sum_{i \\in N} \\sum_{r=1}^{R_{i}} \\frac{N_{i}^{t^{\\prime}}}{R_{i}} \\min \\left(1, \\sum_{j \\in M} \\sum_{k=1}^{m_{j}} a_{j i k}^{r t^{\\prime}} \\tilde{x}_{j k}^{t^{\\prime}}\\right) \\\\\nf_{h}\\left(\\tilde{\\mathbf{x}}, t^{\\prime}\\right) & =\\sum_{t=t^{\\prime}}^{T} \\sum_{i \\in N} \\sum_{r=1}^{R_{i}} \\frac{N_{i}^{t}}{R_{i}} \\min \\left(1, \\sum_{j \\in M} \\sum_{k=1}^{m_{j}} a_{j i k}^{r t} \\tilde{x}_{j k}^{t}\\right)\n\\end{aligned}\n$$\n\nwith $f_{m}$ and $f_{h}$ being (respectively) for the myopic and hyperoptic search modes.\nIndependently of the search mode, each greedy heuristic starts with the trivial, zero solution (which is always feasible). It then iterates over each time period. Given a time period, for each station, the heuristic determines whether adding an outlet is feasible. If so, it computes the number of new EVs covered accordingly with the score function for the search mode ( $f_{m}$ or $f_{h}$ ). The outlet which maximises the value of the score function is then selected, and the candidate solution updated. The iteration over stations for the given period continues until no outlets can feasibly be added (either due to the budget or the maximum number of outlets at each station), or the total number of EVs does not increase after adding a station. The latter is possible if all triplets covered by a possible outlet are already covered in the incumbent solution. The heuristic then proceeds to the next time period and repeats the process.\n\n# 5.3 GRASP \n\nGRASP is characterised by two phases. The first utilises a greedy approach to generate solutions, where each greedy move is randomly selected from all possible moves that result in a solution with an objective value that is within a factor $\\alpha$ of the optimal greedy move. The second phase performs a local search procedure on each solution from the first phase. This method was first applied to the maximum covering problem by Resende (1998). However, the algorithm described in this work makes several adaptations in order to support the multi-period and sizing considerations.\n\nFirst phase The solution construction phase is similar to the Greedy algorithm, with the addition of the parameter $\\alpha \\in[0,1]$. We randomly select one outlet to place from amongst the set of outlets that result in an increase within $100 \\times \\alpha \\%$ of the best possible outlet. The myopic and hyperoptic search modes also apply in the GRASP method.\n\nSolution Filtering In our method, the second phase of GRASP takes considerably longer than the first phase. As such, it is beneficial to filter out unpromising solutions early on. In a method proposed in Resende and Ribeiro (2018), we examine whether"
    },
    {
      "markdown": "the local search method, when applied to a candidate solution, is likely to result in a better objective value than our incumbent solution. For a given number of candidate solutions, we examine the relative increase to the objective function before and after applying the local search. For all subsequent candidate solutions, we then estimate the maximum objective value from the second phase by multiplying the objective value of the candidate solution by the maximum relative increase that was observed. If this results in an objective value that is less than our current best, we filter the candidate solution and do not start the second phase.\n\nSecond Phase When examining a candidate solution $\\hat{\\mathbf{x}}$, we consider the three following moves:\n\nAdd: If the budget permits, we add an outlet to the given station $j$ in period $t$. To ensure feasibility of the solution, we also increase the number of outlets for all subsequent periods $t+1, \\ldots, T$ for station $j$.\n\nTransfer: If the station $j$ has at least one outlet, we consider each station $j^{\\prime}, j^{\\prime} \\neq j$, and transfer all resources spent on station $j$ in each period $t, t+1, \\ldots, T$ to be spent on station $j^{\\prime}$ instead. To ensure feasibility of the solution, we set the number of outlets at station $j$ for periods $t^{\\prime} \\geq t$ to the value in period $t-1$ (or $x_{j k}^{0}$ if $t=1$ ). If station $j^{\\prime}$ reaches the maximum number of outlets and there are resources remaining, they are spent on station $j$.\n\nSplit: If the station $j$ has at least one outlet, we consider each station $j^{\\prime}, j^{\\prime}>j$, and we evenly split the resources spent on stations $j$ and $j^{\\prime}$ in each period $t, t+1, \\ldots, T$. We note that this move is symmetric, and so it is only necessary to attempt this move if $j^{\\prime}>j$. In order to ensure feasibility of the solution, we can only use this move if the resources spent on these stations and the prior values of the solution for these stations in period $t-1$ allow us to open both stations and place at least one outlet in each.\n\nThe moves can be applied to the candidate solution using either the \"first improvement\" or \"best improvement\" methods as described in Resende and Ribeiro (2018). In the first improvement method, the candidate solution $\\hat{\\mathbf{x}}$ is updated whenever a move is found which improves the objective function $f(\\hat{\\mathbf{x}})$. In the best improvement method, the candidate solution $\\hat{\\mathbf{x}}$ is updated with the move from amongst all stations $j$ which resulted in the highest objective function $f(\\hat{\\mathbf{x}})$.\n\nStopping Criteria We wish to prevent the local search from spending considerable time making very minor improvements to the candidate solution. At the end of each loop through the stations, we check the increase in the objective function via the local search."
    },
    {
      "markdown": "If the relative increase to the objective function falls below a given threshold, the local search immediately ends the search in the given period and proceeds to the following one.\n\nThe GRASP algorithm terminates when one of the following conditions have been satisfied: i) a threshold number of candidate solutions have been examined, ii) a threshold number of candidate solutions have been filtered out or, iii) a time limit has been reached.\n\n# 6 Computational Results \n\nIn this section, we analyse the results from computational experiments using the models and heuristic methods discussed in the previous sections. In Section 6.1, we describe the network and datasets used in our experiments. In Section 6.2, we assess the advantage of the MC model (3) over the SL model (2) when solving both with a MILP solver. In Section 6.3, we compare the capabilities of the GF model and the MC model. We show that the MC model (3) can more accurately reflect effects which are known from the literature to affect EV purchase. Finally, in Section 6.4, we discuss the limitations of the MC model (3) motivating, in Section 6.5, a computational study comparing it with our heuristic methods.\n\nAll tests were run on a server running Linux version 3.10, with an Intel Core i7-4790 CPU with eight virtual cores and 32 GB of RAM. The code is written in Python 3.7, and is publicly available ${ }^{1}$. We use CPLEX version 12.10, accessed via the DoCPLEX module (version 2.21). Parameter values can be found in Appendix B, and instances used in the simulations are publicly accessible ${ }^{2}$.\n\n### 6.1 Test Environment\n\nThe network used for the simulations is based on the smallest aggregation level in the 2016 census (Statistics Canada 2017) for the city of Trois-Rivières, Québec. This defines 317 zones within the city, with populations and aggregate characteristics given for each zone. Nodes in the graph are given by the centroids of each zone. The edges in the graph are created between adjacent zones, with the edge length being the Euclidean distance between the centroids. We note that the Saint Lawrence river divides the city into two parts. Edges have been added to the graph to account for the Laviolette bridge, which connects both parts. The network is shown in Figure 3, with the nodes shown as points.\n\nWe generated five datasets, each containing 20 instances with a list of candidate stations, a set of user classes, and pre-computed error terms. The parameters and the generation method for the error terms for each dataset are discussed in Appendix B, with key parameter values given in Table 2. We give a summary of the important distinctions in each dataset:\n\n[^0]\n[^0]:    ${ }^{1}$ https://github.com/StevenLamontagne/EVChargingStationModel\n    ${ }^{2}$ https://doi.org/10.7488/ds/3850"
    },
    {
      "markdown": "![img-2.jpeg](img-2.jpeg)\n\nFigure 3: Trois-Rivières network\n\nSimple A small-scale dataset where key parameter values are fixed such that the resulting instances are easy to solve. This is the only dataset which the SL model (2) can solve.\n\nDistance This dataset increases the penalisation term in the alternative-specific constant for each station to account for distance.\n\nHomeCharging For this dataset, we create two user classes in each node: one with and one without access to home charging.\n\nLongSpan This dataset increases the number of years from four to ten, but the user classes remain consistent across the planning horizon.\n\nPrice In this dataset, we simulate a decrease in the price of the EV year-by-year, which affects user classes differently based on their income. The alternative-specific constant for each station is modified based on the income level of the user class and the current year.\n\nThe Simple, Distance, and HomeCharging datasets have a candidate location set with ten options, and users will not consider any station which is more than ten kilometres away. In contrast, the LongSpan and Price datasets have a candidate location with 30 options, and users may consider any charging station regardless of the distance. This results in significantly more difficult problems to solve. In general, CPLEX is not able to solve the exact models for these instances."
    },
    {
      "markdown": "| Parameter | Simple | Distance | HomeCharging | LongSpan | Price |\n| :--: | --: | --: | --: | --: | --: |\n| $T$ | 4 | 4 | 4 | 10 | 4 |\n| $|M|$ | 10 | 10 | 10 | 30 | 30 |\n| $|N|$ | 317 | 317 | 734 | 317 | 1397 |\n| $R_{i}$ | $15-105$ | $15-105$ | $15-105$ | 465 | 465 |\n| $m_{j}$ (all stations) | 2 | 6 | 6 | 6 | 6 |\n\nTable 2: Parameter values for the generated instances.\n\n# 6.2 Comparison of the Single-Level and Maximum Covering Models \n\nIn order to illustrate the advantages of the maximum covering formulation over the singlelevel version, we solve all instances in the Simple dataset using both formulations. Table 3 reports the following statistics averaged over the 20 instances: The CPU time for the root and branch-and-cut, as well as the optimality gaps for each phase and the number of nodes, are as reported in the CPLEX log file. For the number of instances solved, we consider an instance to be solved if the solver terminates with a provably-optimal solution. For the CPU time in the linear relaxation, neither the Python API nor the CPLEX log directly give the time to solve the linear relaxation of the model. Since CPLEX may run additional methods at the root node to more rapidly solve a discrete optimisation problem (e.g. cuts or heuristics) rather than simply solving its linear relaxation, we ran the solver a second time with the continuous versions of all the variables. As such, the CPU time for the linear relaxation may be higher than for the root node, due to run-time differences.\n\nWe note a large difference in the solving time of the models. In addition to the average improvement between the MC model (3) and the SL model (2), we also note that the former displays small variance: for the SL model (2), the solving times ranged from $1,978.21$ to $4,724.34$ seconds, whereas for the MC model (3), the solving times ranged from 0.22 to 0.32 seconds. We also observe improvements in the optimality gap at the root node as well as in the number of nodes explored, likely due to the presence of the Big-M constraints in the SL model (2).\n\n### 6.3 Comparison of the Maximum Covering and GF Models\n\nWe compare the capabilities of the GF model (Anjos et al. 2020) with those of the MC model (3). To accurately compare the models, we only use the node-based, intracity part of the GF model. Parameter values are chosen to match as closely as possible between both models. The modified GF model, as well as the parameters, are presented in Appendix C.\n\nWe assume that the capacity of each charging outlet is infinite in the GF model. This"
    },
    {
      "markdown": "|  | MC | SL |\n| :-- | :--: | --: |\n| CPU time (LP, sec) | 0.83 | 4466.75 |\n| CPU time (root, sec) | 0.23 | 2294.71 |\n| CPU time (B\\&C, sec) | 0.03 | 729.24 |\n| Optimality gap (root, \\%) | 0.69 | 2.15 |\n| Optimality gap (B\\&C, \\%) | 0.00 | 0.00 |\n| Nodes explored | 8.50 | 769.85 |\n| Instances solved | 20 | 20 |\n\nTable 3: Average performance of CPLEX applied to the MC model and the SL model in the Simple dataset; LP denotes the linear relaxation and B\\&C denotes the branch-andcut.\nis consistent with the assumption in the MC model that the stations are uncapacitated.\nIn Sections 6.3.1 and 6.3.2, we consider two cases. In the first case, we force the solver to use the same solution for both the GF and the MC models. This allows for comparing the spread of EVs around charging stations. In the second case, we find the solution returned by the solver for the GF model. We then calculate the objective value of the MC model (3) using that solution (by using (4)). This allows us to analyse if the differences in the spread of EVs has an impact on solution quality.\n\n# 6.3.1 Distance to Charging Station \n\nDistance is a key factor in determining which facility users choose to patronise in the maximum capture problem (Benati and Hansen 2002, Eiselt et al. 2019) as well as in models that examine existing EV owners' choice of charging location (Luo et al. 2015, Vermeulen et al. 2019, Wolbertus et al. 2021). These works all find that users are less likely to select a facility as the distance increases. To our knowledge, there are no studies which examine the impact of the distance of charging stations to users in the decision to purchase an EV, but we assume that similar results hold in this case. That is, the utility of a charging option (and thus the likelihood that the charging option acts as a primary recharging method) decreases with distance.\n\nIn the GF model, all users have a maximum distance within which they consider charging stations. At a given node, users consider charging at any charging station within that maximum distance.\n\nIn the MC model (3), we also assume that the users have a maximum distance for considering charging stations. However, additionally, the utility decreases with distance. For this comparison, we use the Distance dataset described in Section 6.1.\n\nIn Figure 4, we see the percentage of the population that purchases an EV (at the"
    },
    {
      "markdown": "![img-3.jpeg](img-3.jpeg)\n\nFigure 4: Percentage of population in each zone which purchases an EV by the end of the simulation when examining the distance to the charging station. GF model on left side, MC model on right side.\n\n|  | GF | GF (Adjusted) | MC |\n| :-- | :--: | :--: | :--: |\n| 5th percentile | 9117.18 | 12954.33 | 16496.45 |\n| Median | 9266.85 | 13113.74 | 16592.65 |\n| 95th percentile | 9407.89 | 13244.96 | 16764.57 |\n\nTable 4: Number of EVs from the solutions of the GF and MC models.\nend of the planning horizon) when one station is opened. On the left, in the GF model, we see that the EV adoption rate is the same across the entire region that considers that station. By comparison, on the right in the MC model, we see that the EV adoption rate decreases as the distance increases.\n\nIn Table 4, we report the value of (4) for the solutions from both models. We see that the optimal objective values for the GF model are around $42 \\%$ lower than those for the MC model. However, the incentive for the GF model to place more outlets is linked to the capacity of each station. Thus, in the uncapacitated case, it will only place one outlet at any station it opens. To counteract this effect and compare the models more fairly, we examine the objective values of adjusted solutions. These set the capacity of each station selected to be open by the GF model to its maximum capacity of 6 outlets. Despite this being an infeasible solution (due to the budget), the optimal objective values for the adjusted GF model are still around $20.6 \\%$ lower than those for the MC model.\n\nWe note the difference in the spread of EVs observed in Figure 4, with the spread in the MC case being more consistent with the literature (Benati and Hansen 2002, Eiselt et al. 2019). Additionally, as we report in Table 4, the quality of the solutions are considerably different between the two models. This indicates that these differences"
    },
    {
      "markdown": "have an important impact in the solutions, and highlights the benefits of the maximum covering formulation.\n\n# 6.3.2 Access to Home Charging \n\nGiven it is a significant factor in the decision to purchase an EV, accurately modelling access to home charging is critical (Hidrue et al. 2011, Bailey et al. 2015).\n\nIn the GF model, it is assumed that a given fraction of new EV owners will have access to home charging (which depends on the year, but not the location). The total number of EVs at each location, including both those who have access to home charging and those who do not, is then bound by the capacity of nearby stations. Consequently, if there are no charging outlets sufficiently close to the users, not even those with home charging access may purchase EVs. We note this effect in Figure 6.\n\nIn the maximum covering model (3), the population and home charging access for each user class can be set independently. By creating two user classes for each area, with appropriately set populations, we can more accurately model the percentage of the population that has access to home charging. Additionally, since the two user classes are separate in the model, the users who have access to home charging are allowed to purchase EVs, even if no public charging infrastructure is sufficiently close. For this comparison, we use the HomeCharging dataset described in Section 6.1.\n\nIn Figure 5, we depict the percentage of the population in each area that purchase EVs by the end of the simulation period simply because of home charging access (according to the MC model (3)). In other words, even if no public charging infrastructure is installed, these users can charge at home and decide to purchase an EV. By contrast, in Figure 6, we depict the percentage of the population at the end of the simulation period that purchase EVs when one station is opened. On the left, in the GF model, we note that only users near the charging station have purchased EVs. By comparison on the right, in the MC model (3), we note that the users that were covered by home charging in Figure 5 have purchased EVs. Additionally, we see that near the charging station there is an increase to the percentage of the population that purchases EVs, as users who were not covered by home charging access are now covered by the charging station.\n\nIn Table 5, we report the value of (4) for the solutions from both models. We see that not accounting for home charging access results in a decrease in the number of EVs of around $23.8 \\%$. As before, we examine an adjusted solution to take the infinite capacity into account. Despite this being an infeasible solution, it results in a decrease in the numbers of EVs of around $10.8 \\%$ compared to the MC model. Clearly, the same findings emerge as in Section 6.3.1."
    },
    {
      "markdown": "![img-4.jpeg](img-4.jpeg)\n\nFigure 5: Percentage of Population Covered by Home Charging Access.\n![img-5.jpeg](img-5.jpeg)\n\nFigure 6: Percentage of population in each zone which purchases an EV by the end of the simulation when examining the home charging access. GF model on left side, MC model on right side.\n\n|  | GF | GF (Adjusted) | MC |\n| :-- | :--: | :--: | :--: |\n| 5th percentile | 13648.43 | 15990.52 | 17975.55 |\n| Median | 13737.12 | 16091.57 | 18036.37 |\n| 95th percentile | 13780.56 | 16133.63 | 18085.95 |\n\nTable 5: Number of EVs from the solutions of the GF and MC models."
    },
    {
      "markdown": "|  | Simple | Distance | HomeCharging | LongSpan | Price |\n| :-- | :--: | :--: | :--: | :--: | :--: |\n| CPU time (LP, sec) | 0.83 | 1.01 | 4.33 | - | - |\n| CPU time (root, sec) | 0.23 | 2.12 | 6.29 | 7202.90 | 7203.88 |\n| CPU time (B\\&C, sec) | 0.03 | 0.53 | 4.51 | - | - |\n| Optimality gap (root, \\%) | 0.69 | 2.47 | 2.41 | 37.34 | 75.14 |\n| Optimality gap (B\\&C, \\%) | 0 | 0 | 0 | 37.34 | 75.14 |\n| Nodes explored | 8.50 | 99.95 | 447.75 | 0 | 0 |\n| Instances solved | 20 | 20 | 20 | 0 | 0 |\n\nTable 6: Average performance of CPLEX applied to the MC model. The entries for the Simple dataset are copied from Table 3, for ease of comparison.\n\n# 6.4 Limitations of the Maximum Covering Model \n\nWhile the maximum covering formulation significantly improves tractability by MILP solvers compared to the single-level formulation, our problem remains difficult to solve for large instances. To demonstrate this, we solve the MC model (3) over all instances in all five datasets, restricting CPLEX to a time limit of 7,200 seconds. In Table 6, we report the average performance, using the same statistics reported in Section 6.2.\n\nWe first note that CPLEX is not able to solve any of the instances in the LongSpan and Price datasets within the time limit. Moreover, not only can it not complete the root node, it is not even able to solve the LP relaxation This highlights the complexity of the problem, even for a moderate-sized city and only 30 candidate locations. Concerning the three smallest datasets (Simple, Distance, and HomeCharging) which are all solved to optimality, we remark that the optimality gap at the root node is quite good, suggesting that the majority of the difficulty lies in solving the root node. Finally, we note that, while most of the statistics of each instance are close to the average, the number of nodes explored and the CPU time for the branch-and-cut phase vary, depending on how quickly the optimal solution is found.\n\n### 6.5 Comparing Heuristics\n\nWe compare solving the MC model (3) via the standard branch-and-cut approach used by CPLEX (labelled as \"Exact\" in the results) and the heuristics presented in Section 5. We impose a time limit of two hours ( 7,200 seconds) for the Exact and all heuristic methods. In the cases of the Exact method and the Rolling Horizon method, this time limit is given directly to CPLEX, and thus only limits the CPLEX solving time. The Greedy procedure is tested using both the myopic and hyperoptic search methods. For the Rolling Horizon method, we examine two ways of distributing the time across the years. In the first, we divide the time evenly amongst all years (\"Even\"). In the second, the time limit is divided geometrically, with the first year having a time limit of 3,600"
    },
    {
      "markdown": "seconds and each successive year having half of the previous time (\"Geometric\"). For the GRASP procedure, we test both the myopic and hyperoptic search methods. We set the value of $\\alpha$ to 0.85 , as recommended for the maximum covering problem in Resende and Ribeiro (2018). The GRASP procedures run until 300 solutions have been examined, or until 500 solutions have been filtered out. The second phase of the GRASP procedure uses the first improvement method.\n\n# 6.5.1 Solving Time \n\nIn Table 7, we report the 5th percentile, the 95 th percentile, and the average solving time across all instances of a given dataset and method. For the small datasets (Simple, Distance, HomeCharging), the solving time of the Exact method is only surpassed by the Greedy and Rolling Horizon methods. Both Greedy methods are undoubtedly the fastest. This is the case in the Simple and Distance datasets (with the Rolling Horizon methods being nearly as fast in the Simple dataset), however, it is more noticeable in the HomeCharging, Price, and LongSpan datasets.\n\nThe Rolling Horizon methods both solve quickly for the small datasets. In the LongSpan test set, the Rolling Horizon methods solve more quickly than the Exact method. Since the user classes are the same for each year, solutions from previous years act as good quality warmstart solutions. This allows the later years in the Rolling Horizon method to terminate before the time limit. However, this does not occur in the Price test set. Since the user classes change each year, the quality of the solution for previous years is poorer, which causes the solver to reach the time limit.\n\nWhile the GRASP methods took longer to solve than the RollingHorizon methods in the small datasets, they scaled better for the Price dataset. This resulted in a solving time around a sixth that of the RollingHorizon and Exact methods. In the LongSpan dataset, the solving times for the GRASP method are relatively high. This is due to the fact that both the first and second phases iterate over every year, which causes the solving time to increase substantially as the number of time years increases. The hyperoptic method is solved noticeably slower than the myopic method.\n\n### 6.5.2 Solution Quality\n\nIn Table 8, we report the 5 th percentile, the 95 th percentile, and the average gaps to the best known solution for all instances of a given test set and method. More specifically, for each instance, we examine which method found the solution with the highest objective, whose value is denoted as bestSol. The gap for each method is then given by $\\operatorname{gap}\\left(x^{*}\\right)=$ $\\frac{\\text { bestSol }-f\\left(x^{*}\\right)}{\\text { bestSol }}$, where $x^{*}$ is the solution found by the given method.\n\nAdditionally, we give the number of instances in which a method has found a solution with objective value equal to that of the best known solution. In the case of the"
    },
    {
      "markdown": "|  |  | Simple | Distance | HomeCharging | Price | LongSpan |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n| Exact | 5th percentile | 0.22 | 2.26 | 9.17 | 7203.50 | 7202.70 |\n|  | Average | 0.27 | 2.66 | 10.80 | 7203.98 | 7202.99 |\n|  | 95th percentile | 0.30 | 3.04 | 11.89 | 7204.51 | 7203.27 |\n| GreedyOne (Myopic) | 5th percentile | 0.10 | 0.15 | 0.15 | 1.03 | 1.17 |\n|  | Average | 0.10 | 0.16 | 0.39 | 1.06 | 1.23 |\n|  | 95th percentile | 0.10 | 0.17 | 1.07 | 1.09 | 1.65 |\n| GreedyOne (Hyperoptic) | 5th percentile | 0.21 | 0.29 | 0.29 | 2.20 | 4.98 |\n|  | Average | 0.21 | 0.31 | 0.57 | 2.27 | 5.09 |\n|  | 95th percentile | 0.21 | 0.33 | 1.19 | 2.36 | 5.12 |\n| RollingHorizon (Even) | 5th percentile | 0.17 | 0.37 | 1.92 | 7201.49 | 3557.43 |\n|  | Average | 0.18 | 0.40 | 2.09 | 7226.27 | 3919.75 |\n|  | 95th percentile | 0.19 | 0.41 | 2.22 | 7298.76 | 4238.00 |\n| RollingHorizon (Geometric) | 5th percentile | 0.17 | 0.37 | 1.92 | 7201.47 | 7096.51 |\n|  | Average | 0.18 | 0.40 | 2.08 | 7219.97 | 7163.96 |\n|  | 95th percentile | 0.19 | 0.41 | 2.21 | 7314.78 | 7186.91 |\n| GRASP (Myopic) | 5th percentile | 66.48 | 78.20 | 88.06 | 851.76 | 1593.75 |\n|  | Average | 71.22 | 83.74 | 91.55 | 873.47 | 1635.97 |\n|  | 95th percentile | 81.70 | 87.18 | 101.45 | 896.95 | 1666.46 |\n| GRASP (Hyperoptic) | 5th percentile | 99.27 | 119.29 | 128.16 | 1405.71 | 3058.92 |\n|  | Average | 105.07 | 122.85 | 132.76 | 1433.38 | 3121.60 |\n|  | 95th percentile | 113.94 | 127.47 | 138.17 | 1478.21 | 3197.92 |\n\nTable 7: Comparison of solving times for heuristic methods across all datasets. Times are given in seconds."
    },
    {
      "markdown": "Simple, Distance, and HomeCharging datasets, the exact solution is known, thus the corresponding entries for the heuristic methods are the optimality gaps.\n\nWhile the Exact method produces the best solution value for the smaller tests (Simple, Distance, HomeCharging), it is unable to find solutions which are as good as the heuristic methods in the Price and LongSpan datasets.\n\nThe Greedy methods performed slightly worse than the other heuristic methods in the Simple, Distance, and Home Charging datasets, but they performed surprisingly well in the LongSpan and Price datasets. They frequently found the best solution, and with gaps under $0.1 \\%$ even in cases where the method did not find the best solution.\n\nThe Rolling Horizon methods perform well in the smaller test sets but, similar to the Exact method, they do not perform as well in the LongSpan and Price datasets as the other heuristic methods. Both GRASP methods performed comparable to each other, and comparable with the Greedy methods. However, the GRASP methods were more consistently able to produce good-quality solutions across all datasets as compared to the Greedy methods, as can be seen in the Distance dataset.\n\n# 7 Conclusion \n\nIn this work, we proposed a model for determining the optimal location of EV charging stations in a long-term planning environment so as to maximise the total number of EVs. To consider user-specific characteristics, we used discrete choice models to represent the decision of the users to purchase EVs. When compared to the existing model for this problem (the GF model in Anjos et al. 2020) this allowed for more intuitive user behaviour with regards to charging station location and home charging access. Additionally, solutions for the GF model were significantly different than those for the MC model, highlighting the benefits of using the latter.\n\nUsing the simulation-based approach of Pacheco Paneque et al. (2021) resulted in a bilevel model. By reformulating the model as a maximum covering problem, the sets of Big-M constraints were removed, thus improving the tractability. We note that this reformulation can be applied to other applications of the simulation-based method (including the MCPRU) if no capacity constraints are present.\n\nFor more difficult instances, several heuristic methods were proposed for obtaining feasible solutions. While the Rolling Horizon heuristic was not as effective for more difficult instances, the Greedy and GRASP algorithms both performed very well. In particular, we note that the Greedy methods were able to find solutions within a few seconds, even on the most difficult instances. Additionally, the GRASP methods can obtain solutions of near-optimal quality within a few minutes for the small instances, and they can easily surpass the quality of the best solution obtained from the exact method, within less than half the time limit. The similar performances of the Greedy and GRASP methods suggests that more complex local search moves may be necessary to find better"
    },
    {
      "markdown": "|  |  | Simple | Distance | HomeCharging | Price | LongSpan |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n| Exact | 5th percentile | 0.00 | 0.00 | 0.00 | 12.67 | 8.86 |\n|  | Average | 0.00 | 0.00 | 0.00 | 12.74 | 8.94 |\n|  | 95th percentile | 0.00 | 0.00 | 0.01 | 12.83 | 9.01 |\n|  | \\# of best | 20 | 20 | 20 | 0 | 0 |\n| GreedyOne (Myopic) | 5th percentile | 0.00 | 1.66 | 0.46 | 0.00 | 0.00 |\n|  | Average | 0.02 | 2.08 | 0.53 | 0.01 | 0.01 |\n|  | 95th percentile | 0.07 | 2.76 | 0.68 | 0.05 | 0.03 |\n|  | \\# of best | 14 | 0 | 0 | 11 | 15 |\n| GreedyOne (Hyperoptic) | 5th percentile | 0.00 | 1.47 | 0.44 | 0.00 | 0.00 |\n|  | Average | 0.07 | 2.03 | 0.61 | 0.02 | 0.02 |\n|  | 95th percentile | 0.19 | 2.53 | 0.84 | 0.06 | 0.05 |\n|  | \\# of best | 9 | 0 | 0 | 8 | 10 |\n| RollingHorizon (Even) | 5th percentile | 0.00 | 0.00 | 0.00 | 12.33 | 4.11 |\n|  | Average | 0.00 | 0.07 | 0.02 | 12.66 | 4.19 |\n|  | 95th percentile | 0.00 | 0.38 | 0.06 | 12.83 | 4.27 |\n|  | \\# of best | 20 | 14 | 12 | 0 | 0 |\n| RollingHorizon (Geometric) | 5th percentile | 0.00 | 0.00 | 0.00 | 12.51 | 2.52 |\n|  | Average | 0.00 | 0.07 | 0.02 | 12.72 | 3.95 |\n|  | 95th percentile | 0.00 | 0.38 | 0.06 | 12.83 | 4.26 |\n|  | \\# of best | 20 | 14 | 12 | 0 | 0 |\n| GRASP (Myopic) | 5th percentile | 0.00 | 0.14 | 0.16 | 0.00 | 0.10 |\n|  | Average | 0.02 | 0.43 | 0.26 | 0.02 | 0.18 |\n|  | 95th percentile | 0.12 | 0.68 | 0.36 | 0.04 | 0.24 |\n|  | \\# of best | 16 | 0 | 0 | 5 | 0 |\n| GRASP (Hyperoptic) | 5th percentile | 0.00 | 0.19 | 0.12 | 0.00 | 0.10 |\n|  | Average | 0.03 | 0.44 | 0.23 | 0.04 | 0.19 |\n|  | 95th percentile | 0.16 | 0.67 | 0.36 | 0.07 | 0.26 |\n|  | \\# of best | 14 | 0 | 0 | 3 | 0 |\n\nTable 8: Comparison of gaps to the best known solution for heuristic methods in all five datasets (in percentage)."
    },
    {
      "markdown": "solutions.\nWhile the heuristic methods were able to quickly find feasible solutions, we are not able to verify the quality of these solutions on the larger instances. Further research will examine an exact method specifically tailored for larger scale instances. A few approaches are possible. Firstly, the structure of the problem resembles the resource-constrained production scheduling problem (RCPSP), for which a specialised algorithm exists (Bienstock and Zuckerberg 2010, Muñoz et al. 2018). The method (which is similar to column generation) has a mechanism for bounding the number of basis elements. However, when this bound is applied to our problem, it is greater than the maximum number of basis elements. As such, a complete enumeration is possible, and the method may require solving the full MC model (3). A successful modification and implementation of this algorithm for our problem would be the subject of future research. A second possible approach is the Bender's decomposition method proposed in Cordeau et al. (2019), which is designed for large-scale maximum covering problems. Since the restricted master problem does not include the full set of covering constraints, and solutions to the subproblem can be calculated analytically, the method seems quite well-suited. However, in our preliminary testing, we have found poor convergence. In part, this is likely due to the higher ratio of stations to users as compared with the original paper, which the authors note to be an important factor. As such, research is ongoing to improve the performance of this method in our problem.\n\nSince the MC model (3) was designed for the intracity network, it is not applicable to larger geographical areas. For example, in the MC model (3), there are no constraints related to the range of EVs, which would be necessary for intercity travel. This is a notable difference with the GF model of Anjos et al. (2020), which was designed for intracity and intercity networks, and was applied to the province of Québec. As such, further research will examine an extension of the MC model (3) which includes the intercity network.\n\n# Acknowledgements \n\nThe authors thank the anonymous reviewers whose comments helped to improve the manuscript. In particular, one reviewer proposed a reformulation of the model which greatly improved the convergence rate, and led to the version presented here.\n\nThe authors gratefully acknowledge the assistance of Jean-Luc Dupré from Direction Mobilité of Hydro-Québec, for both providing and helping to understand EV charging data, as well as for sharing his expertise on EV charging stations and the network. We gratefully acknowledge the work of Mahsa Moghaddass in estimating the parameter values used in the models.\n\nThis research was supported by Hydro-Québec, NSERC Collaborative Research and Development Grant CRDPJ 536757 - 19, and NSERC Discovery grant 2017-06054."
    },
    {
      "markdown": "# References \n\nRobert Aboolian, Oded Berman, and Dmitry Krass. Competitive facility location model with concave demand. European Journal of Operational Research, 181(2):598-619, 2007.\nMartin Achtnicht, Georg Bühler, and Claudia Hermeling. The impact of fuel availability on demand for alternative-fuel vehicles. Transportation Research Part D: Transport and Environment, 17(3):262-269, May 2012.\nMiguel F. Anjos, Bernard Gendron, and Martim Joyce-Moniz. Increasing electric vehicle adoption through the optimal deployment of fast-charging stations for local and long-distance travel. European Journal of Operational Research, 285(1):263-278, 2020.\nAssociation des Véhicules Électrique du Québec. Statistiques SAAQ-AVÉQ sur l'électromobilité au Québec en date du 30 juin 2021, 2021.\nJ. Axsen, S. Goldberg, J. Bailey, G. Kamiya, B. Langman, J. Cairns, M. Wolinetz, and A. Miele. Electrifying vehicles: Insights from the canadian plug-in electric vehicle study. Technical report, Simon Fraser University, 2015a.\nJonn Axsen, Joseph Bailey, and Marisol Andrea Castro. Preference and lifestyle heterogeneity among potential plug-in electric vehicle buyers. Energy Economics, 50:190-201, July 2015b.\nBadak Badri-Koohi, Reza Tavakkadi-Moghaddam, and Mahnaz Asghari. Optimizing number and locations of alternative fuel stations using a multi-criteria approach. Engineering, Technology $\\mathcal{E}$ Applied Science Research, 9(1):3715-3720, 2019.\nJoseph Bailey, Amy Miele, and Jonn Axsen. Is awareness of public charging associated with consumer interest in plug-in electric vehicles? Transportation Research Part D: Transport and Environment, 36:1-9, 2015.\nStefano Benati. The maximum capture problem with heterogeneous customers. Computers $\\mathcal{E}$ Operations Research, 26(14):1351-1367, 1999.\nStefano Benati and Pierre Hansen. The maximum capture problem with random utilities: Problem formulation and algorithms. European Journal of Operational Research, 143(3): $518-530,2002$.\nOded Berman, Tammy Drezner, Zvi Drezner, and Dmitry Krass. Modeling competitive facility location problems: New approaches and results. INFORMS TutORials in Operations Research, 14(2014):156-181, October 2014.\nDaniel Bienstock and Mark Zuckerberg. Solving LP relaxations of large-scale precedence constrained problems. In Friedrich Eisenbrand and F. Bruce Shepherd, editors, Integer Programming and Combinatorial Optimization, pages 1-14, Berlin, Heidelberg, 2010. Springer Berlin Heidelberg.\nMichel Bierlaire. Electrifying vehicles: Insights from the canadian plug-in electric vehicle study. Technical Report TRANSP-OR 200605, Transport and Mobility Laboratory, ENAC, EPFL, 2020.\nIsmail Capar, Michael Kuby, V. Jorge Leon, and Yu-Jiun Tsai. An arc cover-path-cover formulation and strategic analysis of alternative-fuel station locations. European Journal of Operational Research, 227(1):142-151, 2013."
    },
    {
      "markdown": "Richard Church and Charles ReVelle. The maximal covering location problem. Papers of the regional science association, 32(1):101-118, 1974.\nMakena Coffman, Paul Bernstein, and Sherilyn Wee. Electric vehicles revisited: a review of factors that affect adoption. Transport Reviews, 37(1):79-93, 2017.\nJean-François Cordeau, Fabio Furini, and Ivana Ljubić. Benders decomposition for very large scale partial set covering and maximal covering location problems. European Journal of Operational Research, 275(3):882-896, 2019.\nQiushi Cui, Yang Weng, and Chin-Woo Tan. Electric vehicle charging station placement method for urban areas. IEEE Transactions on Smart Grid, 10(6):6552-6565, November 2019.\nTien Thanh Dam, Thuy Anh Ta, and Tien Mai. Submodularity and local search approaches for maximum capture problems under generalized extreme value models. European Journal of Operational Research, 300(3):953-965, 2022.\nH. A. Eiselt, Vladimir Marianov, and Tammy Drezner. Competitive location models. In G. Laporte, S. Nickel, and F. Saldanha da Gama, editors, Location Science, chapter 14, pages 391-429. Springer, 2019.\nEnvironment and Climate Change Canada. Greenhouse gas sources and sinks: executive summary 2021, 2021.\nInès Frade et al. Optimal location of charging stations for electric vehicles in a neighborhood in Lisbon, Portugal. Transportation Research Record Journal of the Transportation Research Board, 2252:91-98, 2011.\nAlexandre S. Freire, Eduardo Moreno, and Wilfredo F. Yushimitoa. A branch-and-bound algorithm for the maximum capture problem with random utilities. European Journal of Operational Research, 252(1):204-212, 2016.\nSebastián González, Felipe Feijooa, Franco Bassoa, Vignesh Subramanianb, Sriram Sankaranarayananc, and Tapas Dasd. Routing and charging facility location for EVs under nodal pricing of electricity: A bilevel model solved using special ordered set. IEEE Transactions on Smart Grid, 13(4):3059-3068, 2022.\nKnut Haase. Discrete location planning. Technical report, Institute for Transport and Logistics Studies, University of Sydney, 2009.\nKnut Haase and Sven Müller. A comparison of linear reformulations for multinomial logit choice probabilities in facility location models. European Journal of Operational Research, 232 (3):689-691, 2014.\n\nAndré Hackbarth and Reinhard Madlener. Consumer preferences for alternative fuel vehicles: A discrete choice analysis. Transportation Research Part D: Transport and Environment, 25:5-17, December 2013.\nMichael K. Hidrue, George R. Parsons, Willett Kempton, and Meryl P. Gardner. Willingness to pay for electric vehicles and their attributes. Resource and Energy Economics, 33(3): $686-705,2011$.\nInternational Energy Agency. Greenhouse gas emissions from energy: Overview, 2021.\nRoxana J. Javid and Ali Nejat. A comprehensive model of regional electric vehicle adoption and penetration. Transport Policy, 54:30-42, 2017."
    },
    {
      "markdown": "Ahmed Abdelmoumene Kadri, Romain Perrouault, Mouna Kchaou Boujelben, and Céline Gicquel. A multi-stage stochastic integer programming approach for locating electric vehicle charging stations. Computers \\& Operations Research, 117:104888, 2020.\nSeow Lim and Michael Kuby. Heuristic algorithms for siting alternative-fuel stations using the Flow-Refueling Location Model. European Journal of Operational Research, 204(1):51-61, 2010 .\nIvana Ljubić and Eduardo Moreno. Outer approximation and submodular cuts for maximum capture facility location problems with random utilities. European Journal of Operational Research, 266(1):46-56, 2018.\nChao Luo, Yih-Fang Huang, and Vijay Gupta. Placement of EV charging stations-balancing benefits among multiple entities. IEEE Transactions on Smart Grid, 10(1109):1-10, 2015.\nTien Mai and Andrea Lodi. A multicut outer-approximation approach for competitive facility location under random utilities. European Journal of Operational Research, 284(3):874881, 2020.\nGonzalo Muñoz, Daniel Espinoza, Marcos Goycoolea, Eduardo Moreno, Maurice Queyranne, and Orlando Rivera Letelier. A study of the Bienstock-Zuckerberg algorithm: applications in mining and resource constrained project scheduling. Computational Optimization and Applications, 69:501-534, 2018.\nAlan T. Murray. Maximal coverage location problem: Impacts, significance, and evolution. International Regional Science Review, 39(1):5-27, 2016.\nMichael Nicholas, Dale Hall, and Nic Lutsey. Quantifying the electric vehicle charging infrastructure gap across U.S. markets. Technical report, International Council on Clean Transportation, 2019.\nMeritxell Pacheco Paneque et al. Integrating advanced discrete choice models in mixed integer linear optimization. Transportation Research Part B: Methodological, 146:26-49, 2021.\nMauricio G.C. Resende. Computing approximate solutions of the maximum covering problem with GRASP. Journal of Heuristics, 4(2):161-177, 1998.\nMauricio G.C. Resende and Celso C. Ribeiro. Optimisation By GRASP: Greedy Randomized Adaptive Search Procedures. Springer, 2018.\nZeinab Rezvani, Johan Jansson, and Jan Bodin. Advances in consumer electric vehicle adoption research: A review and research agenda. Transportation Research Part D: Transport and Environment, 34:122-136, 2015.\nAviral Shukla, Joseph Pekny, and Venkat Venkatasubramanian. An optimization framework for cost effective design of refueling station infrastructure for alternative fuel vehicles. Computers \\& Chemical Engineering, 35(8):1431-1438, 2011.\nAnkur Sinha, Pekka Malo, and Kalyan Deb. A review on bilevel optimization: From classical to evolutionary approaches and applications. IEEE Transactions on Evolutionary Computation, 22(2):276-295, 2017.\nStatistics Canada. 2016 census, catalogue no. 98-401-x2016044, 2017.\nKenneth Train. Discrete Choice Methods with Simulation. Cambridge University Press, 2002."
    },
    {
      "markdown": "Igna Vermeulen, Jurjen Rienk Helmus, Mike Lees, and Robert van den Hoed. Simulation of future electric vehicle charging behavior-effects of transition from PHEV to FEV. World Electric Vehicle Journal, 10(2), 2019.\nJoan Walker, Moshe Ben-Akiva, and Denis Bolduc. Identification of the logit kernel (or mixed logit) model. In 10th International Conference on Travel Behavior Research, 2004.\nRick Wolbertus, Robert van den Hoed, Maarten Kroesen, and Caspar Chorus. Charging infrastructure roll-out strategies for large scale introduction of electric vehicles in urban areas: An agent-based simulation study. Transportation Research Part A: Policy and Practice, $148: 262-285,2021$.\nJongRoul Woo, Hyunhong Choi, and Joongha Ahn. Well-to-wheel analysis of greenhouse gas emissions for electric vehicles based on electricity generation mix: A global perspective. Transportation Research Part D: Transport and Environment, 51:340-350, 2017.\nAnpeng Zhang, Jee Eun Kang, and Changhyun Kwon. Incorporating demand dynamics in multiperiod capacitated fast-charging location planning for electric vehicles. Transportation Research Part B: Methodological, 103:5-29, 2017.\nAndreas Ziegler. Individual characteristics and stated preferences for alternative energy sources and propulsion technologies in vehicles: A discrete choice analysis for Germany. Transportation Research Part A: Policy and Practice, 46(8):1372-1385, October 2012."
    },
    {
      "markdown": "# A Bilevel Optimisation Model \n\nThe natural hierarchical structure of our problem suggests a bilevel formulation. Bilevel optimisation models sequential decision making, where first, the leader takes a decision (upper level) and then, the followers react by solving an optimisation problem (lower level). The optimal solution of a bilevel model are the decision values for the leader that optimise its objective function, based on the optimal reaction of the lower-level users to the values of those variables. In our case, the decision maker is in the upper-level while the users are in the lower-level.\n\nThe choice in the lower-level to purchase an EV is modelled via a discrete choice model, where the users (followers) maximise their utility. More specifically, the users must choose an alternative from a finite set of available alternatives (here, open stations, home charging, and opt-out). The value of each alternative is predicted through the use of a utility function, which associates the value of a given alternative for users based on observable and unobservable factors. Under the RUM assumption, users then, as rational beings, select the alternative which presents the maximum benefit to them, as represented by the alternative with the highest utility. For each period $1 \\leq t \\leq T$, user class $i \\in N$, and alternative $j \\in \\mathcal{C}_{i}^{t}(\\mathbf{x})$, the utility is denoted $u_{j i}^{t}$.\n\nThe analyst has imperfect knowledge of the utility of the users, so we model it as a random variable. Hence, instead of a deterministic model identifying the alternative chosen by the users, we obtain a probability distribution over the set of available alternatives. Consequently, the leader maximises the expected number of users purchasing an EV or, equivalently, minimises the expected number of users that do not purchase an EV. This is given by\n\n$$\n\\min _{x \\in X} \\sum_{t=1}^{T} \\sum_{i \\in N} N_{i}^{t} \\mathbb{P}_{\\varepsilon}\\left[u_{0 i}^{t}(x, \\varepsilon) \\geq u_{j i}^{t}(x, \\varepsilon), \\forall j \\in \\mathcal{C}_{i}^{t}(x)\\right]\n$$\n\nwhere $X$ denotes the upper-level constraints, and $\\varepsilon$ denotes the random error term. These constraints are discussed in more detail in Appendix A.2. We recall that index $j=0$ indicates the opt-out alternative, thus $u_{0 i}^{t}$ is the opt-out utility for user class $i$ in year $t$.\n\nIf the error terms are independent, and identically extreme-value type I distributed, the choice probabilities have an analytic formula (the well-known MNL model). In our application, this assumption may not hold. For example, if stations are near each other, they will also have similar amenities near them (e.g. restaurants, shopping centres, etc.). If a user places high value in those amenities (and they are not explicitly included in the observable factors), the error terms for those stations may be highly correlated. To allow for general discrete choice models which relax this restriction and support flexible substitution patterns, we use the simulation-based approach of Pacheco Paneque et al. (2021).\n\nRecall that $R_{i}$ is the number of scenarios for user class $i, P$ is the set of triplets $(t, i, r)$ for user class $i$, alternative $j$, scenario $r$, and period $t$, and $\\varepsilon_{j i}^{r t}$ is the realisation of the"
    },
    {
      "markdown": "random variable $\\varepsilon$ in triplet $(t, i, r)$. Then, $\\forall j \\in C_{i}^{t}(x)$, we denote\n\n$$\nw_{j i}^{r t}= \\begin{cases}1, & \\text { if } j \\in \\operatorname{argmax}_{j^{\\prime} \\in C_{i}^{t}(x)}\\left\\{u_{j^{\\prime} i}^{t}\\left(x, \\varepsilon_{j^{\\prime} i}^{r t}\\right)\\right\\} \\\\ 0, & \\text { otherwise }\\end{cases}\n$$\n\nThe details of the lower-level problem are discussed in Appendix A.1. For the sake of simplicity, in a flagrant abuse of notation, we denote the vector $\\mathbf{w}=\\left\\{w_{j i}^{r t}\\right\\}$ with $w_{j i}^{r t}$ given by (6) for each $(t, i, r), j \\in C_{i}^{t}(x)$ as $\\mathbf{w} \\in \\operatorname{argmax}_{j \\in C(x)}\\{u(x, \\varepsilon)\\}$. Then, we can write a sample average approximation of (5) as\n\n$$\n\\begin{aligned}\n& \\min _{x \\in X} \\sum_{(t, i, r) \\in P} \\frac{N_{i}^{t}}{R_{i}} w_{0 i}^{r t} \\\\\n& \\text { s.t. } \\mathbf{w}=\\operatorname{argmax}_{j \\in C(x)}\\{u(x, \\varepsilon)\\}\n\\end{aligned}\n$$\n\n# A. 1 Lower-Level Problem \n\nThe lower-level problem is assumed to be separable for each user class, each period, and each scenario, meaning that there is no interaction among them. Therefore, in what follows, we concentrate on detailing a given triplet $(t, i, r)$. For each alternative $j \\in \\mathcal{C}_{i}^{t}(x)$, let $u_{j i}^{r t}=u_{j i}^{t}\\left(x, \\varepsilon_{j i}^{r t}\\right)$ be the simulated utility.\n\nWe previously remarked that the choice set $\\mathcal{C}_{i}^{t}(\\mathbf{x})$ depends on which stations are open and we defined the choice sets $C_{i}^{0 t}$ and $C_{i}^{1 t}$ as the sets related to alternatives exogenous and endogenous to the optimisation model, respectively. To ensure that the alternative associated with a closed station $j \\in C_{i}^{1 t}$ cannot be chosen, we set the simulated utility $u_{j i}^{r t}$ to a lower bound if $x_{j 1}^{t}=0$. This concept is referred to as the \"discounted utility\" in Pacheco Paneque et al. (2021). Let $\\underline{a}_{i}^{t}=\\min \\left(\\left\\{\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}, j \\in C_{i}^{1 t}, 1 \\leq r \\leq R_{i}\\right\\}\\right)$ and $b_{j i}^{r t}=\\sum_{k=1}^{m_{j}} \\beta_{j i k}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}$ be respectively lower and upper bounds on the simulated utility $u_{j i}^{r t}$, and let $\\nu_{j i}^{t}=b_{j i}^{r t}-\\underline{a}_{i}^{t}$. For each $i \\in N$, we assume that $R_{i}$ is sufficiently large such that for each $1 \\leq t \\leq T, 1 \\leq r \\leq R_{i}$ we have $\\underline{a}_{i}^{t}<u_{0 i}^{r t}$. We note that the lower bound $\\underline{a}_{i}^{t}$ could be strengthened by adding the utility of one outlet, (e.g. $\\min \\left\\{\\beta_{j 1}^{r t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}\\right\\}$ ). However, in our testing, this did not have a significant impact. We also note that, since the error terms $\\varepsilon_{j i}^{r t}$ can come from unbounded distributions, it is not generally possible to use a fixed lower bound for $u_{0 i}^{r t}$, e.g. $\\underline{a}_{i}^{t}=0$."
    },
    {
      "markdown": "The linear formulation for the simulated utility $u_{j i}^{r t}$ is given by\n\n$$\n\\begin{array}{ll}\nu_{j i}^{r t} \\geq \\underline{a}_{i}^{t}, & j \\in C_{i}^{1 t},(t, i, r) \\in P \\\\\nu_{j i}^{r t} \\leq \\underline{a}_{i}^{t}+\\nu_{j i}^{r t} x_{j 1}^{t}, & j \\in C_{i}^{1 t},(t, i, r) \\in P \\\\\nu_{j i}^{r t} \\geq \\sum_{k=1}^{m_{j}} \\beta_{j i k}^{t} x_{j k}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}-\\nu_{j i}^{r t}\\left(1-x_{j 1}^{t}\\right), & j \\in C_{i}^{1 t},(t, i, r) \\in P \\\\\nu_{j i}^{r t} \\leq \\sum_{k=1}^{m_{j}} \\beta_{j i k}^{t} x_{j k}^{t}+\\kappa_{j i}^{t}+\\varepsilon_{j i}^{r t}, & j \\in C_{i}^{1 t},(t, i, r) \\in P\n\\end{array}\n$$\n\nFor each $(t, i, r) \\in P$, the value of $w_{j i}^{r t}$ for $j \\in C_{i}^{0 t} \\cup C_{i}^{1 t}$ is then given by the solution of the following optimisation problem, which acts as the lower-level problem in our bilevel optimisation model:\n\n$$\n\\begin{aligned}\n& \\text { Maximise } \\sum_{j \\in C_{i}^{0 t}} w_{j i}^{r t} u_{j i}^{r t}+\\sum_{j \\in C_{i}^{1 t}} w_{j i}^{r t} u_{j i}^{r t} \\\\\n& \\text { subject to } \\sum_{j \\in C_{i}^{0 t}} w_{j i}^{r t}+\\sum_{j \\in C_{i}^{1 t}} w_{j i}^{r t}=1 \\\\\n& \\quad w_{j i}^{r t} \\in\\{0,1\\}, \\quad j \\in C_{i}^{0 t} \\cup C_{i}^{1 t}\n\\end{aligned}\n$$\n\nIt is easy to see that the binary requirements can be relaxed.\n\n# A. 2 Upper-Level Problem \n\nThe placement of charging outlets and stations in the upper-level is restricted by the following set of constraints\n\n$$\n\\begin{array}{ll}\n\\sum_{j \\in M} \\sum_{k=1}^{m_{j}} c_{j k}^{t}\\left(x_{j k}^{t}-x_{j k}^{t-1}\\right) \\leq B^{t}, & 1 \\leq t \\leq T \\\\\nx_{j k}^{t} \\leq x_{j k-1}^{t}, & 1 \\leq t \\leq T, j \\in M \\\\\nx_{j k}^{t} \\geq x_{j k}^{t-1}, & 1 \\leq t \\leq T, j \\in M, 1 \\leq k \\leq m_{j}\n\\end{array}\n$$\n\nThese correspond to Constraints (2b)-(2d) presented in Section 3.4. Note that it would also be possible to supplement the per-period budget with an overall budget, as was done in Anjos et al. (2020).\n\nConstraints (13) enforces that if we have at least $k$ outlets, we must also have at least $k-1$ outlets.\n\nConstraints (14) forbid the model from removing charging outlets. These constraints assume that it would be suboptimal to remove a station."
    },
    {
      "markdown": "# A. 3 Bilevel Model \n\nWe now introduce the full, bilevel model\n\n$$\n\\begin{aligned}\n& \\text { Minimise } \\sum_{(t, i, r) \\in P} \\frac{N_{i}^{t}}{R_{i}} w_{0 i}^{r t} \\\\\n& \\text { subject to }(1),(7)-(10),(12)-(14) \\\\\n& \\quad w_{j i}^{r t} \\in \\operatorname{argmax}\\left\\{\\sum_{j \\in C_{i}^{0 t}} w_{j i}^{r t} u_{j i}^{r t}+\\sum_{j \\in C_{i}^{1 t}} w_{j i}^{r t} u_{j i}^{r t}:(11 \\mathrm{~b})-(11 \\mathrm{c})\\right\\} \\\\\n& \\quad u_{j i}^{r t} \\in \\mathbb{R} \\\\\n& \\quad x_{j k}^{t} \\in\\{0,1\\}\n\\end{aligned}\n$$\n\nWe consider the optimistic version of the bilevel problem which means that the users do not select the opt-out alternative if a different alternative has equal utility. While this in theory has a zero probability (given that the error terms are drawn from continuous distributions), this can occur in practice due to numerical precision.\n\nIn order to solve the model, we reformulate it as a single-level optimisation problem by transforming the lower-level model (11) into a series of constraints for the upper-level model. To this end, we apply the Karush-Kuhn-Tucker conditions which are necessary and sufficient for the optimality of the (linear) lower-level problem (Sinha et al. 2017), and we linearize the terms $w_{j i}^{r t} \\cdot u_{j i}^{r t}$ through Big-M constraints. In this way, for each $(t, i, r) \\in P$, the lower-level problem (11) is replaced by the following constraints:\n\n$$\n\\begin{aligned}\n& u_{j i}^{r t}-\\alpha_{i}^{r t}+\\left(1-w_{j i}^{r t}\\right) \\mu_{j i}^{r t} \\geq 0, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t} \\\\\n& \\sum_{j \\in C_{i}^{0 t}} w_{j i}^{r t}+\\sum_{j \\in C_{i}^{1 t}} w_{j i}^{r t}=1 \\\\\n& \\alpha_{i}^{r t} \\geq u_{j i}^{r t}, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t} \\\\\n& w_{j i}^{r t} \\in\\{0,1\\}, j \\in C_{i}^{0 t} \\cup C_{i}^{1 t} \\\\\n& \\alpha_{i}^{r t} \\in \\mathbb{R}\n\\end{aligned}\n$$\n\nwhere the Big-M constants, $\\mu_{j i}^{r t}$, are given by\n\n$$\n\\mu_{j i}^{r t}=\\left\\{\\begin{array}{l}\n\\max \\left(\\left\\{b_{j i}^{r t}, j \\in C_{i}^{1 t}\\right\\} \\cup\\left\\{\\kappa_{j i}^{r t}+\\varepsilon_{j i}^{r t}, j \\in C_{i}^{0 t}\\right\\}\\right)-\\kappa_{j i}^{r t}-\\varepsilon_{j i}^{r t}, \\quad j \\in C_{i}^{0 t} \\\\\n\\max \\left(\\left\\{b_{j i}^{r t}, j \\in C_{i}^{1 t}\\right\\} \\cup\\left\\{\\kappa_{j i}^{r t}+\\varepsilon_{j i}^{r t}, j \\in C_{i}^{0 t}\\right\\}\\right)-g_{i}^{t}, \\quad j \\in C_{i}^{1 t}\n\\end{array}\\right.\n$$\n\n## B Parameter Values\n\nIn this section, we describe the parameter values for each dataset, as well as the mechanism for drawing error terms for each of the instances. We start by describing the general"
    },
    {
      "markdown": "framework used for the error terms, as that is common to all of the datasets. Table 9 provides a list of parameter values, with more detailed explanations in the following subsections for parameter values which differ. Unless otherwise specified, parameter values are set arbitrarily. We note that, in all datasets, the number of scenarios is set to $15 \\times\\left|C_{0}^{i t} \\cup C_{1}^{i t}\\right|$. In the case of the Simple, Distance, and HomeCharging datasets, the size of $C_{1}^{i t}$ varies by user class, due to the maximum distance of 10 km for considering a charging station. As a consequence, the number of scenarios varies from 15 (only the opt-out is considered) to 105 (opt-out plus six charging stations). On the contrary, in the Price and LongSpan datasets, there is no maximum distance for consideration, and thus every station is included in the set $C_{1}^{i t}$. As a consequence, $\\left|C_{0}^{i t} \\cup C_{1}^{i t}\\right|=31$, and the number of scenarios is always 465 .\n\nIn all of our datasets:\n\n- Each user class $i \\in N$ includes the home location (as a node in the network). This allows us to estimate population based on the census data (Statistics Canada 2017), with the number of user classes per node and the partitioning method depending on the dataset.\n- Each dataset includes 20 instances, where each instance generates different sets of error terms $\\varepsilon_{j i}^{r t}, j \\in C_{0 i}^{r t} \\cup C_{1 i}^{r t}$.\n- For each $i \\in N, 1 \\leq t \\leq T$, the alternative-specific constant for the opt-out option $\\kappa_{0 i}^{t}$ is set to 4.5 .\n\nIn order to simulate the error terms for the demand model, we employ the error components formulation of the mixed logit model to approximate a nested logit model, as described in Train (2002) and Walker et al. (2004). The notation in what follows matches the latter work, and we refer to the aforementioned work for detailed explanations of the process.\n\nFor each $i \\in N, 1 \\leq t \\leq T, 1 \\leq r \\leq R_{i}$, the vector of error terms $\\varepsilon_{i}^{r t}=\\left(\\varepsilon_{i}^{r t}\\right)_{j \\in C_{i}^{0 i} \\cup C_{j}^{1 i}}$ is given by\n\n$$\n\\varepsilon_{i}^{r t}=F T \\xi^{r}+\\zeta^{r}\n$$\n\nwith\n\n- $F$ a factor loading matrix.\n- $T$ a diagonal matrix with the standard deviation of each factor.\n- $\\xi^{r}$ a vector of IID random terms from a normal distribution.\n- $\\zeta^{r}$ a vector of IID random terms from a Gumbel distribution.\n\nThe form of the matrices $F$ and $T$ vary in each dataset. However, in all datasets, $\\xi^{r}$ has a location of zero and a scale of one, and $\\zeta^{r}$ has location of zero and a scale of three."
    },
    {
      "markdown": "| Parameter | Simple | Distance | HomeCharging | LongSpan | Price |\n| :-- | --: | --: | --: | --: | --: |\n| $T$ | 4 | 4 | 4 | 10 | 4 |\n| $[\\mathrm{M}]$ | 10 | 10 | 10 | 30 | 30 |\n| $[\\mathrm{~N}]$ | 317 | 317 | 634 | 317 | 1397 |\n| $\\left[C_{0}^{n}\\right]$ | 1 | 2 | 1 | 1 | 1 |\n| $\\left[C_{1}^{n}\\right]$ | Varies | Varies | Varies | 30 | 30 |\n| $x_{j k}^{n}$ (all stations and outlets) | 0 | 0 | 0 | 0 | 0 |\n| $R_{i}$ | $15-105$ | $15-105$ | $15-105$ | 465 | 465 |\n| $B^{\\prime}$ (per year) | 400 | 400 | 400 | 400 | 400 |\n| $m_{j}$ (all stations) | 2 | 6 | 6 | 6 | 6 |\n| $c_{j 1}^{t}$ (all stations and years) | 150 | 150 | 150 | 150 | 150 |\n| $c_{j k}^{t}$ (all other outlets) | 50 | 50 | 50 | 50 | 50 |\n\nTable 9: Parameter values for the generated instances\n\n# B. 1 Simple Dataset \n\nThe set of user classes $N$ includes one user class for every node in the network. The population of user class $i, N_{i}^{t}$, is given by the population of the node in the 2016 census multiplied by a factor of 0.1 . In other words, $10 \\%$ of the population in each node are deciding to purchase a vehicle each year.\n\nFor each $i \\in N, 1 \\leq t \\leq T$, the choice set $C_{i}^{1 t}$ includes all stations which are within ten kilometres of the location of the user class. The utility for $j \\in C_{i}^{1 t}$ is linear in terms of the number of charging outlets, with\n\n$$\n\\beta_{j i k}^{t}=0.281 k, \\forall j \\in C_{i}^{1 t}\n$$\n\nAdditionally, the alternative-specific constant for each station $j \\in C_{i}^{1 t}$ is calculated as\n\n$$\n\\kappa_{j i}^{t}=1.464 \\delta_{1}-0.063 \\delta_{2}+0.174 \\delta_{3}\n$$\n\nwith\n\n- $\\delta_{1}$ : binary coefficient indicating if the station is level 3 (i.e. fast charging). We note that in our tests all stations were considered level 3.\n- $\\delta_{2}$ : the distance (in kilometres, shortest path in the network) between the user's home and the charging station,\n- $\\delta_{3}$ : binary coefficient indicating if the station is in the city center (defined as a subset of the nodes in the network).\n\nThe coefficients for these parameters were estimated using real-world data. A discrete choice model was created which examined which charging station was selected by EV owners when recharging their vehicle. A MNL model was estimated with the maximum"
    },
    {
      "markdown": "likelihood approach with the BIOGEME package in Python (Bierlaire 2020), using real charging data for EV owners in the province of Québec.\n\nFor the error terms for each $i \\in N, 1 \\leq t \\leq T$, the options $j \\in C_{i}^{0 t} \\cup C_{i}^{1 t}$ are divided into two nests: one for the opt-out option and one for all charging stations. The $\\left|C_{i}^{0 t} \\cup C_{i}^{1 t}\\right| \\times 2$ factor loading matrix $F$ and $2 \\times 2$ diagonal matrix $T$ are given by\n\n$$\nF=\\left[\\begin{array}{cc}\nc c 1 & 0 \\\\\n0 & 1 \\\\\n\\vdots & \\vdots \\\\\n0 & 1\n\\end{array}\\right], \\quad T=\\left[\\begin{array}{cc}\nc c 1 & 0 \\\\\n0 & 1\n\\end{array}\\right]\n$$\n\n# B. 2 Distance Dataset \n\nThe user classes, choice sets, and error terms are all identical to the Simple dataset.\nThe coefficient for distance in the alternative-specific constant has been increased by a factor of ten. More specifically, for each $i \\in N, 1 \\leq t \\leq T$, the alternative-specific constant for each station $j \\in C_{i}^{1 t}$ is calculated as\n\n$$\n\\kappa_{j i}^{t}=1.464 \\delta_{1}-0.63 \\delta_{2}+0.174 \\delta_{3}\n$$\n\nwith $\\delta_{1}, \\delta_{2}, \\delta_{3}$ defined as in the Simple dataset.\n\n## B. 3 Home Charging Dataset\n\nThe set of user classes $N$ includes two user classes for every node in the network: one which has access to home charging, and one which does not. We estimate the access to home charging via the housing information in the 2016 census (Statistics Canada 2017). Based on recommendations from our industrial partners, we assume that $90 \\%$ of users in single homes have access to home charging, while $75 \\%$ of those in attached homes, and $40 \\%$ of those in apartments also have access. The population of each of the two user classes are given by the respective estimates multiplied by a factor of 0.1 .\n\nFor user classes $i$ which have access to home charging and for each $1 \\leq t \\leq T$, the utility for $j \\in C_{i}^{1 t}$ is linear in terms of the number of charging outlets, with\n\n$$\n\\beta_{j i k}^{t}=0.211 k, \\forall j \\in C_{i}^{1 t}\n$$\n\nFor user classes $i$ which do not have access to home charging and for each $1 \\leq t \\leq T$, the utility for $j \\in C_{i}^{1 t}$ is linear in terms of the number of charging outlets, with\n\n$$\n\\beta_{j i k}^{t}=0.351 k, \\forall j \\in C_{i}^{1 t}\n$$"
    },
    {
      "markdown": "In both cases, the choice set $C_{i}^{1 t}$ includes all stations which are within ten kilometres of the location of the user class and the alternative-specific constants are identical to the Simple dataset.\n\nFor user classes $i$ which do not have access to home charging, the error terms are identical to the Simple dataset. For user classes $i$ which have access to home charging and for each $1 \\leq t \\leq T$, the options $j \\in C_{i}^{0 t} \\cup C_{i}^{1 t}$ are divided into three nests: one for the opt-out option, one for home charging, and one for all charging stations. The $\\left|C_{i}^{0 t} \\cup C_{i}^{1 t}\\right| \\times 3$ factor loading matrix $F$ and $3 \\times 3$ diagonal matrix $T$ are given by\n\n$$\nF=\\left[\\begin{array}{ccc}\nc c c 1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1 \\\\\n\\vdots & \\vdots & \\vdots \\\\\n0 & 0 & 1\n\\end{array}\\right], \\quad T=\\left[\\begin{array}{ccc}\nc c c 1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{array}\\right]\n$$\n\n# B. 4 LongSpan Dataset \n\nThe mechanisms for the user classes, alternative-specific constants, and error terms are all identical to the Simple dataset. However, the choice sets for each user class now include all stations, not only those within ten kilometres. This, combined with the increased number of stations and the longer time span, results in a significantly more difficult problem to solve.\n\n## B. 5 Price Dataset\n\nThe alternative-specific constants, error terms, and choice sets are identical to the LongSpan dataset.\n\nIn this dataset, we simulate a price decrease year-by-year, which affects different user classes differently based on their income. The set of user classes $N$ includes five user classes for every node in the network, based on the partitioning in Javid and Nejat (2017) for income. In the aforementioned work, a logit model for EV acquisition was estimated, with one of the considered factors being the annual household income. The income level was classified as a categorical variable, with the categories defined via income\n\n- Less than $25000 \\$$\n- $25000 \\$$ - $49999 \\$$\n- $50000 \\$$ - $74999 \\$$\n- $75000-99999 \\$$"
    },
    {
      "markdown": "| Income level of user class $i$ | $\\delta_{4 i}$ |\n| :-- | :--: |\n| Less than $25000 \\$$ | -2 |\n| $25000 \\$$ - $49999 \\$$ | -1 |\n| $50000 \\$$ - $74999 \\$$ | 0 |\n| $75000-99999 \\$$ | 1 |\n| Greater or equal to $100000 \\$$ | 2 |\n\nTable 10: Values of parameter $\\delta_{4 i}$\n\n- Greater or equal to $100000 \\$$.\n\nIn the final estimation of the logit model, the income variable was found to be significantly significant. The utility coefficient for the categorical variable was estimated as 0.443 .\n\nIn our work, we estimate the population in each node that falls within each of the five income brackets using the household income field in the 2016 Statistics Canada census (Statistics Canada 2017), and assigned each to a user class. ${ }^{3}$ The population of each of the five user classes are given by the respective estimates multiplied by a factor of 0.1 , and any user class which would have a population $<1$ are removed.\n\nAn additional term is added to the alternative specific constants for all charging stations based on the income bracket, in increments of 0.443 . We then modify the value of the penalisation term each year to account for a decrease in price affecting each user class differently (with the modification affecting the lower income brackets more). More specifically, for each $i \\in N, 1 \\leq t \\leq T$, the alternative-specific constant for each station $j \\in C_{t}^{1 t}$ is calculated as\n\n$$\n\\kappa_{j i}^{t}=1.464 \\delta_{1}-0.063 \\delta_{2}+0.174 \\delta_{3}+0.443 \\delta_{4 i}+0.443(t-1)\\left(\\frac{2-\\delta_{4 i}}{4}\\right)\n$$\n\nwith $\\delta_{1}, \\delta_{2}, \\delta_{3}$ defined as in the Simple dataset and $\\delta_{4 i}$ given in Table 10.\n\n# C Growth Function model \n\n## C. 1 Intracity model\n\nFor comparing the GF model of Anjos et al. (2020) to the MC model (3), it must be reduced to an intracity form. More precise definitions and development of each of these variables and equations, we refer to the previous work. Note that some variable names have\n\n[^0]\n[^0]:    ${ }^{3}$ The census provides data in brackets of $10000 \\$$, and so the population in certain fields was divided evenly into two user classes (e.g. half of the population of the \" $20000 \\$$ to $29999 \\$$ \" field in the census was assigned to the \"Less than $25000 \\$$ \" user class whereas the other half was added to the \" $25000 \\$$ 49 999\\$\" user class.)"
    },
    {
      "markdown": "been changed from the original work to avoid confusion with notation in MC model (3) and the SL model (2). We assume that the city occupies a single urban centre $u$. We also eliminate the path-based constraints from the optimisation model, as these represent users travelling between urban centres. Given these simplifications, we use the following notation:\n\n- $T$ : Set of investment periods.\n- $N$ : Set of population centers.\n- $M$ : Set of candidate locations.\n- $N_{j}, j \\in M$ : Set of locations which are willing to charge at location $j$.\n- $e_{j}, j \\in M$ : Maximum number of charging outlets at location $j$.\n- $r$ : Population of the city.\n- $r_{i}$ : Population in location $i$.\n- $l_{j}, j \\in M$ : Number of charging outlets already installed at location $j$.\n- $c^{U}$ : Cost for installing a charging outlet at any location.\n- $c_{j}^{F}, j \\in M$ : One-time cost for opening location $j$.\n- $B^{t}, t \\in T$ : Budget for year $t$.\n- $\\alpha$ : Fraction of EV users that choose to charge at home.\n- $a^{t}, t \\in T$ : Capacity increase for each charging outlet in year $t$.\n- $S$ : Set of segments in the (piecewise linear) GF.\n- $q^{s-1}, q^{s}, s \\in S$ : Breakpoints of segment $s$ in the growth function.\n- $m^{s}, s \\in S$ : Slope of segment $s$ in the growth function.\n- $o^{s}, s \\in S$ : Intercept of segment $s$ in the growth function.\n- $x_{j}^{t}, j \\in M, t \\in T$ : Number of charging outlets at station $i$ in year $t$.\n- $y_{j}^{t}, j \\in M, t \\in T: 1$ if station is open in year $t, 0$ otherwise.\n- $w^{s t}, s \\in S, t \\in T: 1$ if the city is at penetration level $s$ at the beginning of year $t, 0$ otherwise."
    },
    {
      "markdown": "- $h_{i j}^{t}, i \\in N, j \\in M, t \\in T$ : Number of EVs based in location $i$ choosing to charge in location $j$ in year $t$.\n- $z^{s t}, s \\in S, t \\in T$ : Number of EVs in the city which is at penetration level $s$ at the beginning of year $t$.\n\nThe list of parameter values can be found in Table 11.\nThe model used for the comparisons is the following:\n\nMaximise $\\sum_{j \\in M} \\sum_{i \\in N_{j}} h_{i j}^{t-1}$,\nsubject to $\\sum_{j \\in M} c_{U}\\left(x_{j}^{t}-x_{j}^{t-1}\\right)+\\sum_{j \\in M} c_{j}^{F}\\left(y_{j}^{t}-y_{j}^{t-1}\\right) \\leq B^{t}, \\quad t \\in T$,\n\n$$\n\\begin{aligned}\n& x_{j}^{t} \\leq e_{j} y_{j}^{t}, \\quad j \\in M, 1 \\leq t \\leq T \\\\\n& x_{j}^{t} \\geq x_{j}^{t-1}, \\quad j \\in M, 1 \\leq t \\leq T \\\\\n& y_{j}^{t} \\geq y_{j}^{t-1}, j \\in M, 1 \\leq t \\leq T \\\\\n& \\sum_{s \\in S} z^{s t}=\\sum_{j \\in M} \\sum_{i \\in N_{j}} h_{i j}^{t-1}, t \\in T \\\\\n& q^{s-1} w^{s t} \\leq z^{s t} \\leq q^{s} w^{s t}, s \\in S, t \\in T \\\\\n& \\sum_{s \\in S} w^{s t} \\leq 1, t \\in T \\\\\n& \\sum_{i \\in N_{j}} h_{i j}^{t} \\leq \\sum_{i \\in N_{j}} h_{i j}^{t-1}+\\frac{r_{i}}{r} \\sum_{s \\in S}\\left(o^{s} w^{s t}+\\left(m^{s}-1\\right) z^{s t}\\right), j \\in M, t \\in T \\\\\n& \\sum_{i \\in N_{j}} h_{i j}^{t-1} \\leq \\sum_{i \\in N_{j}} h_{i j}^{t}, j \\in M, t \\in T \\\\\n& \\alpha \\sum_{i \\in N_{j}} h_{i j}^{t} \\leq a^{t}\\left(x_{j}^{0}+\\sum_{t^{\\prime} \\leq t} x_{j}^{t^{\\prime}}\\right) j \\in N, t \\in T\n\\end{aligned}\n$$\n\nThe objective function (30) aims to maximise the total number of EV users in the final year. Constraints (31) are budget constraints, ensuring that the cost of opening charging stations and installing charging outlets does not exceed the budget for that year. Constraints (32) both enforce a maximum number of charging outlets at each station and also ensures that the one-time cost to open charging stations is paid. Constraints (33) prevent removing charging outlets and constraints (34) prevent closing charging stations from one year to the next. Constraints (35) set the number of EVs at the start of one year as the number at the end of the previous year. Constraints (36) find the segment of the growth function that the current EV population is in. Constraints (37) ensure that"
    },
    {
      "markdown": "| Parameter | Value |\n| :-- | --: |\n| $T$ | 4 |\n| $|N|$ | 317 |\n| $|M|$ | 10 |\n| $\\left|N_{j}\\right|$ | Varies |\n| $e_{j}$ (all stations) | 6 |\n| $r$ | 181624 |\n| $l_{j}$ (all stations) | 0 |\n| $c^{U}$ (all stations) | 50 |\n| $c_{j}^{F}$ (all stations) | 100 |\n| $B^{t}$ (per year) | 400 |\n| $\\alpha$ | 0.566 |\n| $a^{t}$ (all years) | $+\\infty$ |\n| $|S|$ | 5 |\n| $q^{s-1}, q^{s}$ | Varies |\n| $m^{s}$ | Varies |\n| $o^{s}$ | Varies |\n\nTable 11: Growth Function parameter values\nonly one segment of the growth function is selected. Constraints (38) cap the the number of EVs by the end of the year by following the growth function. Constraints (39) ensure that the total number of EVs does not decrease from year to year. Constraints (40) are capacity constraints, ensuring that potential new EV users will only decide to purchase an EV if there exists sufficient charging infrastructure.\n\n# C. 2 Generating the Growth Function \n\nThe growth function in the GF model gives the number of EVs in the current year as a function of the number of EVs in the previous year. In the absence of the capacity contraints (40), the growth function would directly dictate the number of EVs each year via Constraints (35). We can ensure that the EV growth remains comparable between the MC and GF models by using the output from the MC model to create the growth function.\n\nMore specifically, we assume there are no EV owners at the start of the optimisation period. While this is not a realistic assumption, it ensures feasibility in the GF model."
    },
    {
      "markdown": "![img-6.jpeg](img-6.jpeg)\n\nFigure 7: Growth Function Example\n\nGiven a candidate solution $(\\mathbf{x}, \\mathbf{y})$, we solve the MC model (3) with the desired user classes and parameters over the 20 instances in the dataset. In each instance and for $1 \\leq t \\leq T$ we calculate the number of users who are covered by $\\mathbf{x}$ (given by $\\sum_{i \\in N} \\sum_{r=1}^{R_{i}} \\frac{N_{i}^{t}}{R_{i}} w_{i}^{r t}$ ). To calculate the total number of EVs, we add the new EVs in each year to the EVs from the previous year (or the starting EVs in the case of the first year). We take the average result over all instances for each year as our desired growth function, which mimics perfectly the EV growth from the MC model (3).\n\nAfter normalising for the population-which gives the percentage of the population with EVs in the following year given the percentage of the population with EVs in the current year-, we extend the growth function to cover the entire $[0,1]$ domain. Both of these steps allow the growth function to be used regardless of population. An example of the normalised, extended growth function is given in Figure 7."
    }
  ],
  "usage_info": {
    "pages_processed": 46,
    "doc_size_bytes": 1214409
  },
  "_metadata": {
    "model_version": "0.0.0",
    "llm_model": "mistral-ocr-2505",
    "query_data": {
      "pdf": "/Users/satyaortiz-gagne/CODE/paperext/data/cache/fulltext/b118a307b9a0bad801a3c95671008452/fulltext.pdf"
    },
    "model_id": "parsepdf"
  }
}